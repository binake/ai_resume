<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AIç®€å†åˆ†æç³»ç»Ÿ</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <div class="container">
        <!-- å·¦ä¾§å·¥ä½œå° -->
        <div class="workspace">
            <div class="workspace-header">
                <div class="workspace-title">å·¥ä½œå°</div>
                <div class="workspace-subtitle">AIç®€å†åˆ†æç³»ç»Ÿ</div>
            </div>

            <div class="workspace-content">
                <!-- æˆ‘çš„é¡¹ç›® -->
                <div class="workspace-section">
                    <div class="section-header" data-section="projects">
                        <span>æˆ‘çš„é¡¹ç›®</span>
                        <span class="expand-icon">â–¼</span>
                    </div>
                    <div class="section-content" id="projectsSection">
                        <div class="add-project" onclick="showNewProjectInput()">
                            <span>+ æ–°å»ºé¡¹ç›®</span>
                        </div>
                        <div class="new-project-input" id="newProjectInput">
                            <input type="text" placeholder="è¾“å…¥é¡¹ç›®åç§°" onkeypress="handleNewProject(event)">
                        </div>
                    </div>
                </div>

                <!-- APIæ¥å£æµ‹è¯• -->
                <div class="workspace-section">
                    <div class="section-header" data-section="api">
                        <span>æµ‹è¯•æ–°çš„APIæ¥å£</span>
                        <span class="expand-icon">â–¼</span>
                    </div>
                    <div class="section-content" id="apiSection">
                        <div class="nav-item" data-page="api-test">
                            <span class="nav-icon">ğŸ”§</span>
                            <span>APIæµ‹è¯•</span>
                        </div>
                        <div class="nav-item" data-page="api-config">
                            <span class="nav-icon">âš™ï¸</span>
                            <span>æ¥å£é…ç½®</span>
                        </div>
                    </div>
                </div>

                <!-- AIå¯¹è¯ -->
                <div class="workspace-section">
                    <div class="section-header" data-section="ai">
                        <span>AIå¯¹è¯</span>
                        <span class="expand-icon">â–¼</span>
                    </div>
                    <div class="section-content" id="aiSection">
                        <div class="nav-item" data-page="ai-chat">
                            <span class="nav-icon">ğŸ’¬</span>
                            <span>æ™ºèƒ½å¯¹è¯</span>
                        </div>
                        <div class="nav-item" data-page="ai-analysis">
                            <span class="nav-icon">ğŸ¤–</span>
                            <span>æ™ºèƒ½åˆ†æ</span>
                        </div>
                    </div>
                </div>

                <!-- æ•°æ®ç®¡ç† -->
                <div class="workspace-section">
                    <div class="section-header active" data-section="data">
                        <span>æ•°æ®ï¼ˆçŸ¥è¯†åº“ï¼‰æ£€ç´¢</span>
                        <span class="expand-icon">â–¼</span>
                    </div>
                    <div class="section-content" id="dataSection">
                        <div class="nav-item active" data-page="dashboard">
                            <span class="nav-icon">ğŸ“Š</span>
                            <span>ä»ªè¡¨æ¿</span>
                        </div>
                        <div class="nav-item" data-page="resumes">
                            <span class="nav-icon">ğŸ“‹</span>
                            <span>ç®€å†ç®¡ç†</span>
                        </div>
                        <div class="nav-item" data-page="analytics">
                            <span class="nav-icon">ğŸ“ˆ</span>
                            <span>æ•°æ®åˆ†æ</span>
                        </div>
                        <div class="nav-item" data-page="knowledge">
                            <span class="nav-icon">ğŸ“š</span>
                            <span>çŸ¥è¯†åº“</span>
                        </div>
                    </div>
                </div>

                <!-- æ•°æ®ä¸Šä¼  -->
                <div class="workspace-section">
                    <div class="section-header" data-section="upload">
                        <span>æ•°æ®ä¸Šä¼ </span>
                        <span class="expand-icon">â–¼</span>
                    </div>
                    <div class="section-content" id="uploadSection">
                        <div class="nav-item" data-page="upload-resume">
                            <span class="nav-icon">ğŸ“„</span>
                            <span>ä¸ªäººç®€å†ä¸Šä¼ </span>
                        </div>
                        <div class="nav-item" data-page="upload-company">
                            <span class="nav-icon">ğŸ¢</span>
                            <span>å…¬å¸ä»‹ç»ä¸Šä¼ </span>
                        </div>
                        <div class="nav-item" data-page="upload-job">
                            <span class="nav-icon">ğŸ’¼</span>
                            <span>å·¥ä½œæ¡ä»¶ä¸Šä¼ </span>
                        </div>
                        <div class="nav-item" data-page="upload-knowledge">
                            <span class="nav-icon">ğŸ“</span>
                            <span>çŸ¥è¯†çºªè¦ä¸Šä¼ </span>
                        </div>
                    </div>
                </div>

                <!-- ç³»ç»Ÿè®¾ç½® -->
                <div class="workspace-section">
                    <div class="section-header" data-section="settings">
                        <span>ç³»ç»Ÿè®¾ç½®</span>
                        <span class="expand-icon">â–¼</span>
                    </div>
                    <div class="section-content" id="settingsSection">
                        <div class="nav-item" data-page="settings">
                            <span class="nav-icon">âš™ï¸</span>
                            <span>ç³»ç»Ÿé…ç½®</span>
                        </div>
                        <div class="nav-item" data-page="user-settings">
                            <span class="nav-icon">ğŸ‘¤</span>
                            <span>ç”¨æˆ·è®¾ç½®</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ä¸»å†…å®¹åŒºåŸŸ -->
        <div class="main-content">
            <!-- é¡¶éƒ¨å¯¼èˆªæ  -->
            <div class="top-bar">
                <div class="breadcrumb">
                    <span class="breadcrumb-item">é¦–é¡µ</span>
                    <span>â€º</span>
                    <span class="breadcrumb-item active" id="currentPage">ä»ªè¡¨æ¿</span>
                </div>
                <div class="user-actions">
                    <button class="action-btn secondary" onclick="testConnection()">æµ‹è¯•è¿æ¥</button>
                    <button class="action-btn" onclick="refreshData()">åˆ·æ–°æ•°æ®</button>
                </div>
            </div>

            <!-- é¡µé¢å†…å®¹ -->
            <div class="page-content">
                <!-- ä»ªè¡¨æ¿é¡µé¢ -->
                <div class="content-area active" id="dashboard">
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-icon">ğŸ“‹</div>
                            <div class="stat-number" id="totalResumes">0</div>
                            <div class="stat-label">æ€»ç®€å†æ•°</div>
                            <div class="stat-trend">+5% æœ¬å‘¨</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">ğŸ†•</div>
                            <div class="stat-number" id="newResumes">0</div>
                            <div class="stat-label">ä»Šæ—¥æ–°å¢</div>
                            <div class="stat-trend">+12% è¾ƒæ˜¨æ—¥</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">ğŸ¯</div>
                            <div class="stat-number" id="avgSkills">0</div>
                            <div class="stat-label">å¹³å‡æŠ€èƒ½æ•°</div>
                            <div class="stat-trend">+8% æœ¬æœˆ</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">â­</div>
                            <div class="stat-number">96%</div>
                            <div class="stat-label">è§£ææˆåŠŸç‡</div>
                            <div class="stat-trend">+2% æœ¬æœˆ</div>
                        </div>
                    </div>

                    <div class="controls-panel">
                        <div class="controls-row">
                            <div class="search-box">
                                <input type="text" class="search-input" id="searchInput" placeholder="æœç´¢ç®€å†...">
                                <span class="search-icon">ğŸ”</span>
                            </div>
                            <div class="filter-group">
                                <select class="filter-select" id="skillFilter">
                                    <option value="">æ‰€æœ‰æŠ€èƒ½</option>
                                </select>
                                <select class="filter-select" id="eduFilter">
                                    <option value="">æ‰€æœ‰å­¦å†</option>
                                </select>
                                <button class="action-btn" onclick="exportData()">å¯¼å‡ºæ•°æ®</button>
                            </div>
                        </div>
                    </div>

                    <div class="resume-grid" id="resumeGrid">
                        <div class="loading">
                            <div class="spinner"></div>
                            æ­£åœ¨åŠ è½½ç®€å†æ•°æ®...
                        </div>
                    </div>
                </div>

                <!-- ç®€å†ç®¡ç†é¡µé¢ -->
                <div class="content-area" id="resumes">
                    <h2 style="margin-bottom: 20px;">ç®€å†ç®¡ç†</h2>
                    <div class="resume-grid" id="resumeManagementGrid">
                        <!-- ç®€å†ç®¡ç†å†…å®¹ -->
                    </div>
                </div>

                <!-- é¡¹ç›®æ–‡ä»¶ä¸Šä¼ é¡µé¢ -->
                <div class="content-area" id="project-upload">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <div>
                            <h2 id="projectUploadTitle">é¡¹ç›®æ–‡ä»¶ä¸Šä¼ </h2>
                            <span class="page-type-indicator project">é¡¹ç›®å­˜å‚¨</span>
                        </div>
                        <button class="action-btn secondary" onclick="loadProjectFiles()">æŸ¥çœ‹å·²ä¸Šä¼ æ–‡ä»¶</button>
                    </div>
                    <div class="upload-area" id="uploadArea-project">
                        <div class="upload-icon">ğŸ“</div>
                        <div class="upload-text">æ‹–æ”¾æ–‡ä»¶åˆ°æ­¤å¤„ï¼Œæˆ–ç‚¹å‡»ä¸Šä¼ </div>
                        <div class="upload-hint">æ”¯æŒ PDFã€DOCã€DOCXã€TXTã€å›¾ç‰‡ç­‰æ ¼å¼ | æ”¯æŒå¤šæ–‡ä»¶é€‰æ‹©å’Œæ–‡ä»¶å¤¹ä¸Šä¼ </div>
                        <input type="file" id="fileInput-project" style="display: none;" accept=".pdf,.doc,.docx,.txt,.png,.jpg,.jpeg,.gif,.xls,.xlsx,.ppt,.pptx,.md" multiple>
                        <div style="margin-top: 15px;">
                            <button class="action-btn secondary" onclick="selectFiles('project')">é€‰æ‹©æ–‡ä»¶</button>
                            <button class="action-btn secondary" onclick="selectFolder('project')" style="margin-left: 10px;">é€‰æ‹©æ–‡ä»¶å¤¹</button>
                        </div>
                    </div>
                    <div id="uploadProgress-project" style="display: none;">
                        <div class="loading">
                            <div class="spinner"></div>
                            æ­£åœ¨ä¸Šä¼ æ–‡ä»¶...
                        </div>
                    </div>
                </div>

                <!-- ä¸Šä¼ ç®€å†é¡µé¢ -->
                <div class="content-area" id="upload-resume">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <div>
                            <h2>ä¸ªäººç®€å†ä¸Šä¼ </h2>
                            <span class="page-type-indicator category">åˆ†ç±»å­˜å‚¨</span>
                        </div>
                        <button class="action-btn secondary" onclick="loadCategoryFiles('resume')">æŸ¥çœ‹å·²ä¸Šä¼ æ–‡ä»¶</button>
                    </div>
                    <div class="upload-area" id="uploadArea-resume">
                        <div class="upload-icon">ğŸ“„</div>
                        <div class="upload-text">æ‹–æ”¾ç®€å†æ–‡ä»¶åˆ°æ­¤å¤„ï¼Œæˆ–ç‚¹å‡»ä¸Šä¼ </div>
                        <div class="upload-hint">æ”¯æŒ PDFã€DOCã€DOCX æ ¼å¼ | æ”¯æŒå¤šæ–‡ä»¶é€‰æ‹©å’Œæ–‡ä»¶å¤¹ä¸Šä¼ </div>
                        <input type="file" id="fileInput-resume" style="display: none;" accept=".pdf,.doc,.docx" multiple>
                        <div style="margin-top: 15px;">
                            <button class="action-btn secondary" onclick="selectFiles('resume')">é€‰æ‹©æ–‡ä»¶</button>
                            <button class="action-btn secondary" onclick="selectFolder('resume')" style="margin-left: 10px;">é€‰æ‹©æ–‡ä»¶å¤¹</button>
                        </div>
                    </div>
                    <div id="uploadProgress-resume" style="display: none;">
                        <div class="loading">
                            <div class="spinner"></div>
                            æ­£åœ¨ä¸Šä¼ å¹¶è§£æç®€å†...
                        </div>
                    </div>
                </div>

                <!-- å…¬å¸ä»‹ç»ä¸Šä¼ é¡µé¢ -->
                <div class="content-area" id="upload-company">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <div>
                            <h2>å…¬å¸ä»‹ç»ä¸Šä¼ </h2>
                            <span class="page-type-indicator category">åˆ†ç±»å­˜å‚¨</span>
                        </div>
                        <button class="action-btn secondary" onclick="loadCategoryFiles('company')">æŸ¥çœ‹å·²ä¸Šä¼ æ–‡ä»¶</button>
                    </div>
                    <div class="upload-area" id="uploadArea-company">
                        <div class="upload-icon">ğŸ¢</div>
                        <div class="upload-text">ä¸Šä¼ å…¬å¸ä»‹ç»æ–‡ä»¶</div>
                        <div class="upload-hint">æ”¯æŒ PDFã€DOCã€DOCXã€TXT æ ¼å¼ | æ”¯æŒå¤šæ–‡ä»¶é€‰æ‹©å’Œæ–‡ä»¶å¤¹ä¸Šä¼ </div>
                        <input type="file" id="fileInput-company" style="display: none;" accept=".pdf,.doc,.docx,.txt" multiple>
                        <div style="margin-top: 15px;">
                            <button class="action-btn secondary" onclick="selectFiles('company')">é€‰æ‹©æ–‡ä»¶</button>
                            <button class="action-btn secondary" onclick="selectFolder('company')" style="margin-left: 10px;">é€‰æ‹©æ–‡ä»¶å¤¹</button>
                        </div>
                    </div>
                    <div id="uploadProgress-company" style="display: none;">
                        <div class="loading">
                            <div class="spinner"></div>
                            æ­£åœ¨ä¸Šä¼ æ–‡ä»¶...
                        </div>
                    </div>
                </div>

                <!-- å·¥ä½œæ¡ä»¶ä¸Šä¼ é¡µé¢ -->
                <div class="content-area" id="upload-job">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <div>
                            <h2>å·¥ä½œæ¡ä»¶ä¸Šä¼ </h2>
                            <span class="page-type-indicator category">åˆ†ç±»å­˜å‚¨</span>
                        </div>
                        <button class="action-btn secondary" onclick="loadCategoryFiles('job')">æŸ¥çœ‹å·²ä¸Šä¼ æ–‡ä»¶</button>
                    </div>
                    <div class="upload-area" id="uploadArea-job">
                        <div class="upload-icon">ğŸ’¼</div>
                        <div class="upload-text">ä¸Šä¼ å·¥ä½œæ¡ä»¶è¯´æ˜</div>
                        <div class="upload-hint">æ”¯æŒ PDFã€DOCã€DOCXã€TXT æ ¼å¼ | æ”¯æŒå¤šæ–‡ä»¶é€‰æ‹©å’Œæ–‡ä»¶å¤¹ä¸Šä¼ </div>
                        <input type="file" id="fileInput-job" style="display: none;" accept=".pdf,.doc,.docx,.txt" multiple>
                        <div style="margin-top: 15px;">
                            <button class="action-btn secondary" onclick="selectFiles('job')">é€‰æ‹©æ–‡ä»¶</button>
                            <button class="action-btn secondary" onclick="selectFolder('job')" style="margin-left: 10px;">é€‰æ‹©æ–‡ä»¶å¤¹</button>
                        </div>
                    </div>
                    <div id="uploadProgress-job" style="display: none;">
                        <div class="loading">
                            <div class="spinner"></div>
                            æ­£åœ¨ä¸Šä¼ æ–‡ä»¶...
                        </div>
                    </div>
                </div>

                <!-- çŸ¥è¯†çºªè¦ä¸Šä¼ é¡µé¢ -->
                <div class="content-area" id="upload-knowledge">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <div>
                            <h2>çŸ¥è¯†çºªè¦ä¸Šä¼ </h2>
                            <span class="page-type-indicator category">åˆ†ç±»å­˜å‚¨</span>
                        </div>
                        <button class="action-btn secondary" onclick="loadCategoryFiles('knowledge')">æŸ¥çœ‹å·²ä¸Šä¼ æ–‡ä»¶</button>
                    </div>
                    <div class="upload-area" id="uploadArea-knowledge">
                        <div class="upload-icon">ğŸ“</div>
                        <div class="upload-text">ä¸Šä¼ çŸ¥è¯†åº“æ–‡æ¡£</div>
                        <div class="upload-hint">æ”¯æŒ PDFã€DOCã€DOCXã€TXTã€MD æ ¼å¼ | æ”¯æŒå¤šæ–‡ä»¶é€‰æ‹©å’Œæ–‡ä»¶å¤¹ä¸Šä¼ </div>
                        <input type="file" id="fileInput-knowledge" style="display: none;" accept=".pdf,.doc,.docx,.txt,.md" multiple>
                        <div style="margin-top: 15px;">
                            <button class="action-btn secondary" onclick="selectFiles('knowledge')">é€‰æ‹©æ–‡ä»¶</button>
                            <button class="action-btn secondary" onclick="selectFolder('knowledge')" style="margin-left: 10px;">é€‰æ‹©æ–‡ä»¶å¤¹</button>
                        </div>
                    </div>
                    <div id="uploadProgress-knowledge" style="display: none;">
                        <div class="loading">
                            <div class="spinner"></div>
                            æ­£åœ¨ä¸Šä¼ æ–‡ä»¶...
                        </div>
                    </div>
                </div>

                <!-- APIæµ‹è¯•é¡µé¢ -->
                <div class="content-area" id="api-test">
                    <h2 style="margin-bottom: 20px;">APIæ¥å£æµ‹è¯•</h2>
                    <div class="stat-card">
                        <h3 style="margin-bottom: 15px;">æ¥å£æµ‹è¯•å·¥å…·</h3>
                        <div class="info-row">
                            <span class="info-label">å½“å‰API:</span>
                            <span class="info-value" id="currentApiUrl">http://localhost:5000/api</span>
                        </div>
                        <div style="margin-top: 20px;">
                            <button class="action-btn" onclick="testAllEndpoints()">æµ‹è¯•æ‰€æœ‰æ¥å£</button>
                            <button class="action-btn secondary" onclick="getSystemInfo()" style="margin-left: 10px;">è·å–ç³»ç»Ÿä¿¡æ¯</button>
                        </div>
                    </div>
                </div>

                <!-- AIå¯¹è¯é¡µé¢ -->
                <div class="content-area" id="ai-chat">
                    <h2 style="margin-bottom: 20px;">AIæ™ºèƒ½å¯¹è¯</h2>
                    <div class="stat-card">
                        <h3 style="margin-bottom: 15px;">æ™ºèƒ½åŠ©æ‰‹</h3>
                        <p>AIå¯¹è¯åŠŸèƒ½å¼€å‘ä¸­...</p>
                    </div>
                </div>

                <!-- æ•°æ®åˆ†æé¡µé¢ -->
                <div class="content-area" id="analytics">
                    <h2 style="margin-bottom: 20px;">æ•°æ®åˆ†æ</h2>
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-icon">ğŸ«</div>
                            <div class="stat-number">985</div>
                            <div class="stat-label">985é™¢æ ¡æ¯”ä¾‹</div>
                            <div class="stat-trend">35%</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">ğŸ’¼</div>
                            <div class="stat-number">3.2å¹´</div>
                            <div class="stat-label">å¹³å‡å·¥ä½œç»éªŒ</div>
                            <div class="stat-trend">ç»éªŒåˆ†å¸ƒå‡åŒ€</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">ğŸ”§</div>
                            <div class="stat-number">Java</div>
                            <div class="stat-label">çƒ­é—¨æŠ€èƒ½</div>
                            <div class="stat-trend">45% æŒæ¡ç‡</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">ğŸŒ</div>
                            <div class="stat-number">åŒ—äº¬</div>
                            <div class="stat-label">ä¸»è¦åŸå¸‚</div>
                            <div class="stat-trend">28% åˆ†å¸ƒ</div>
                        </div>
                    </div>
                </div>

                <!-- çŸ¥è¯†åº“é¡µé¢ -->
                <div class="content-area" id="knowledge">
                    <h2 style="margin-bottom: 20px;">çŸ¥è¯†åº“ç®¡ç†</h2>
                    <div class="stat-card">
                        <h3 style="margin-bottom: 15px;">çŸ¥è¯†åº“ç»Ÿè®¡</h3>
                        <div class="info-row">
                            <span class="info-label">æ–‡æ¡£æ€»æ•°:</span>
                            <span class="info-value">156</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">ä»Šæ—¥æ–°å¢:</span>
                            <span class="info-value">8</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">æ£€ç´¢æ¬¡æ•°:</span>
                            <span class="info-value">1,245</span>
                        </div>
                    </div>
                </div>

                <!-- ç³»ç»Ÿè®¾ç½®é¡µé¢ -->
                <div class="content-area" id="settings">
                    <h2 style="margin-bottom: 20px;">ç³»ç»Ÿè®¾ç½®</h2>
                    <div class="stat-card">
                        <h3 style="margin-bottom: 15px;">APIé…ç½®</h3>
                        <div class="info-row">
                            <span class="info-label">APIåœ°å€:</span>
                            <span class="info-value" id="apiUrl">http://localhost:5000/api</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">æ•°æ®åº“:</span>
                            <span class="info-value">MongoDB (ai_resume)</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">æ–‡ä»¶å­˜å‚¨:</span>
                            <span class="info-value">æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿ</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">çŠ¶æ€:</span>
                            <span class="info-value" id="connectionStatus">æ£€æŸ¥ä¸­...</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- é¡¹ç›®ç®¡ç†æ¨¡æ€æ¡† -->
    <div class="modal" id="projectManagerModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>é¡¹ç›®ç®¡ç†</h3>
                <button class="close-btn" onclick="closeProjectManager()">Ã—</button>
            </div>
            <div class="modal-body">
                <div style="margin-bottom: 20px;">
                    <h4 style="margin-bottom: 10px;">åˆ›å»ºæ–°é¡¹ç›®</h4>
                    <div style="display: flex; gap: 10px;">
                        <input type="text" id="newProjectNameInput" placeholder="é¡¹ç›®åç§°" style="flex: 1; padding: 8px 12px; border: 1px solid #dadce0; border-radius: 6px;">
                        <input type="text" id="newProjectDescInput" placeholder="é¡¹ç›®æè¿°ï¼ˆå¯é€‰ï¼‰" style="flex: 2; padding: 8px 12px; border: 1px solid #dadce0; border-radius: 6px;">
                        <button class="action-btn" onclick="createProjectFromModal()">åˆ›å»º</button>
                    </div>
                </div>

                <div>
                    <h4 style="margin-bottom: 10px;">ç°æœ‰é¡¹ç›®</h4>
                    <div id="projectManagerList">
                        <!-- é¡¹ç›®åˆ—è¡¨å°†åœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- è¯¦æƒ…æ¨¡æ€æ¡† -->
    <div class="modal" id="detailModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modalTitle">è¯¦æƒ…</h3>
                <button class="close-btn" onclick="closeModal()">Ã—</button>
            </div>
            <div class="modal-body" id="modalBody">
                <!-- è¯¦æƒ…å†…å®¹ -->
            </div>
        </div>
    </div>

    <!-- çŠ¶æ€æ¶ˆæ¯ -->
    <div class="status-message" id="statusMessage"></div>

    <script>
        // å…¨å±€å˜é‡
        const API_BASE_URL = 'http://localhost:5000/api';
        let allResumes = [];
        let filteredResumes = [];
        let currentPage = 'dashboard';
        let currentProject = null;
        let allProjects = [];
        let currentCategoryFiles = {}; // å­˜å‚¨å„ç±»åˆ«çš„æ–‡ä»¶åˆ—è¡¨
        let currentProjectFiles = []; // å­˜å‚¨å½“å‰é¡¹ç›®çš„æ–‡ä»¶åˆ—è¡¨

        // æ–‡ä»¶ç±»åˆ«æ˜ å°„
        const FILE_CATEGORIES = {
            'resume': 'ä¸ªäººç®€å†',
            'company': 'å…¬å¸ä»‹ç»',
            'job': 'å·¥ä½œæ¡ä»¶',
            'knowledge': 'çŸ¥è¯†çºªè¦'
        };

        // åˆ›å»ºæ—¥å¿—å¯¹è±¡
        const logger = {
            info: (message) => {
                console.log(`[INFO] ${message}`);
            },
            error: (message) => {
                console.error(`[ERROR] ${message}`);
            },
            warn: (message) => {
                console.warn(`[WARN] ${message}`);
            }
        };

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
        });

        async function initializeApp() {
            setupEventListeners();
            await loadProjects();
            await loadData();
            updateStats();
        }

        function setupEventListeners() {
            // ä¾§è¾¹æ å¯¼èˆªç‚¹å‡»
            document.querySelectorAll('.nav-item').forEach(item => {
                item.addEventListener('click', function() {
                    const page = this.dataset.page;
                    if (page) {
                        switchPage(page);
                    }
                });
            });

            // åˆ†åŒºæŠ˜å /å±•å¼€
            document.querySelectorAll('.section-header').forEach(header => {
                header.addEventListener('click', function() {
                    toggleSection(this.dataset.section);
                });
            });

            // æœç´¢
            document.getElementById('searchInput').addEventListener('input', handleSearch);

            // ä¸ºæ¯ä¸ªç±»åˆ«è®¾ç½®ä¸Šä¼ äº‹ä»¶
            Object.keys(FILE_CATEGORIES).forEach(category => {
                setupCategoryUpload(category);
            });

            // ä¸ºé¡¹ç›®ä¸Šä¼ è®¾ç½®äº‹ä»¶
            setupProjectUpload();

            // æ¨¡æ€æ¡†ç‚¹å‡»å¤–éƒ¨å…³é—­
            document.getElementById('detailModal').addEventListener('click', function(e) {
                if (e.target === this) closeModal();
            });

            document.getElementById('projectManagerModal').addEventListener('click', function(e) {
                if (e.target === this) closeProjectManager();
            });
        }

        function setupCategoryUpload(category) {
            const uploadArea = document.getElementById(`uploadArea-${category}`);
            const fileInput = document.getElementById(`fileInput-${category}`);

            if (!uploadArea || !fileInput) return;

            uploadArea.addEventListener('click', (e) => {
                if (e.target.tagName === 'BUTTON') return;
                fileInput.click();
            });

            uploadArea.addEventListener('dragover', handleDragOver);
            uploadArea.addEventListener('dragleave', handleDragLeave);
            uploadArea.addEventListener('drop', (e) => handleDrop(e, category));

            fileInput.addEventListener('change', (e) => handleFileSelect(e, category));
        }

        function setupProjectUpload() {
            const uploadArea = document.getElementById('uploadArea-project');
            const fileInput = document.getElementById('fileInput-project');

            if (!uploadArea || !fileInput) return;

            uploadArea.addEventListener('click', (e) => {
                if (e.target.tagName === 'BUTTON') return;
                fileInput.click();
            });

            uploadArea.addEventListener('dragover', handleDragOver);
            uploadArea.addEventListener('dragleave', handleDragLeave);
            uploadArea.addEventListener('drop', (e) => handleDrop(e, 'project'));

            fileInput.addEventListener('change', (e) => handleFileSelect(e, 'project'));
        }

        function selectFiles(category) {
            const fileInput = document.getElementById(`fileInput-${category}`);
            if (fileInput) {
                fileInput.removeAttribute('webkitdirectory');
                fileInput.click();
            }
        }

        function selectFolder(category) {
            const fileInput = document.getElementById(`fileInput-${category}`);
            if (fileInput) {
                fileInput.setAttribute('webkitdirectory', '');
                fileInput.click();
            }
        }

        function switchProject(projectId) {
            document.querySelectorAll('.project-item').forEach(item => {
                item.classList.remove('active');
            });

            const projectElement = document.querySelector(`[data-project="${projectId}"]`);
            if (projectElement) {
                projectElement.classList.add('active');
            }

            currentProject = projectId;
            const project = allProjects.find(p => p._id === projectId);
            const projectName = project ? project.name : 'æœªçŸ¥é¡¹ç›®';

            // åˆ‡æ¢åˆ°é¡¹ç›®æ–‡ä»¶ä¸Šä¼ é¡µé¢
            switchPage('project-upload');

            // æ›´æ–°é¡¹ç›®ä¸Šä¼ é¡µé¢çš„æ ‡é¢˜
            const titleElement = document.getElementById('projectUploadTitle');
            if (titleElement) {
                titleElement.textContent = `${projectName} - æ–‡ä»¶ä¸Šä¼ `;
            }

            showMessage(`å·²åˆ‡æ¢åˆ°é¡¹ç›®: ${projectName}`, 'info');

            // åŠ è½½é¡¹ç›®æ–‡ä»¶åˆ—è¡¨
            loadProjectFiles();
        }

        function toggleSection(sectionId) {
            const header = document.querySelector(`[data-section="${sectionId}"]`);
            const content = document.getElementById(sectionId + 'Section');

            header.classList.toggle('collapsed');
            content.classList.toggle('collapsed');
        }

        function switchPage(page) {
            // æ›´æ–°å¯¼èˆªçŠ¶æ€
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });

            const navItem = document.querySelector(`[data-page="${page}"]`);
            if (navItem) {
                navItem.classList.add('active');
            }

            // æ›´æ–°é¢åŒ…å±‘
            const pageNames = {
                'dashboard': 'ä»ªè¡¨æ¿',
                'resumes': 'ç®€å†ç®¡ç†',
                'project-upload': 'é¡¹ç›®æ–‡ä»¶ä¸Šä¼ ',
                'upload-resume': 'ä¸ªäººç®€å†ä¸Šä¼ ',
                'upload-company': 'å…¬å¸ä»‹ç»ä¸Šä¼ ',
                'upload-job': 'å·¥ä½œæ¡ä»¶ä¸Šä¼ ',
                'upload-knowledge': 'çŸ¥è¯†çºªè¦ä¸Šä¼ ',
                'api-test': 'APIæµ‹è¯•',
                'ai-chat': 'AIå¯¹è¯',
                'analytics': 'æ•°æ®åˆ†æ',
                'knowledge': 'çŸ¥è¯†åº“',
                'settings': 'ç³»ç»Ÿè®¾ç½®'
            };
            document.getElementById('currentPage').textContent = pageNames[page] || page;

            // åˆ‡æ¢é¡µé¢å†…å®¹
            document.querySelectorAll('.content-area').forEach(area => {
                area.classList.remove('active');
            });
            document.getElementById(page).classList.add('active');

            currentPage = page;

            // åŠ è½½é¡µé¢ç‰¹å®šå†…å®¹
            if (page === 'resumes') {
                loadResumeManagement();
            } else if (page === 'settings') {
                checkConnectionStatus();
            } else if (page.startsWith('upload-')) {
                const category = page.replace('upload-', '');
                if (FILE_CATEGORIES[category]) {
                    loadCategoryFiles(category);
                }
            } else if (page === 'project-upload') {
                loadProjectFiles();
            }
        }

        function showNewProjectInput() {
            const inputDiv = document.getElementById('newProjectInput');
            inputDiv.style.display = 'block';
            inputDiv.querySelector('input').focus();
        }

        function handleNewProject(event) {
            if (event.key === 'Enter') {
                const input = event.target;
                const projectName = input.value.trim();

                if (projectName) {
                    createProject(projectName).then(success => {
                        if (success) {
                            input.value = '';
                            document.getElementById('newProjectInput').style.display = 'none';
                        }
                    });
                }
            } else if (event.key === 'Escape') {
                event.target.value = '';
                document.getElementById('newProjectInput').style.display = 'none';
            }
        }

        async function loadProjects() {
            try {
                const response = await fetch(`${API_BASE_URL}/projects`);

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }

                allProjects = await response.json();
                renderProjectList();

                if (!currentProject && allProjects.length > 0) {
                    currentProject = allProjects[0]._id;
                }

                logger.info(`æˆåŠŸåŠ è½½ ${allProjects.length} ä¸ªé¡¹ç›®`);

            } catch (error) {
                console.error('åŠ è½½é¡¹ç›®å¤±è´¥:', error);
                showMessage('åŠ è½½é¡¹ç›®å¤±è´¥: ' + error.message, 'error');
            }
        }

        function renderProjectList() {
            const projectsSection = document.getElementById('projectsSection');
            if (!projectsSection) return;

            const addProjectElement = projectsSection.querySelector('.add-project');
            const newProjectInputElement = projectsSection.querySelector('.new-project-input');

            const projectItems = projectsSection.querySelectorAll('.project-item');
            projectItems.forEach(item => item.remove());

            allProjects.forEach((project, index) => {
                const projectElement = document.createElement('div');
                projectElement.className = `project-item ${index === 0 && !currentProject ? 'active' : ''}`;
                projectElement.setAttribute('data-project', project._id);
                projectElement.innerHTML = `
                    <div class="project-dot"></div>
                    <span title="${project.description || project.name}">${project.name}</span>
                `;

                projectElement.addEventListener('click', function() {
                    switchProject(project._id);
                });

                projectsSection.insertBefore(projectElement, addProjectElement);
            });

            if (!currentProject && allProjects.length > 0) {
                currentProject = allProjects[0]._id;
                document.querySelector(`[data-project="${currentProject}"]`)?.classList.add('active');
            }
        }

        async function createProject(name, description = '') {
            try {
                const response = await fetch(`${API_BASE_URL}/projects`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ name, description })
                });

                const result = await response.json();

                if (response.ok) {
                    showMessage(`é¡¹ç›® "${name}" åˆ›å»ºæˆåŠŸ`, 'success');
                    await loadProjects();

                    if (result.project) {
                        switchProject(result.project._id);
                    }

                    return true;
                } else {
                    showMessage(result.error || 'åˆ›å»ºé¡¹ç›®å¤±è´¥', 'error');
                    return false;
                }

            } catch (error) {
                console.error('åˆ›å»ºé¡¹ç›®å¤±è´¥:', error);
                showMessage('åˆ›å»ºé¡¹ç›®å¤±è´¥: ' + error.message, 'error');
                return false;
            }
        }

        async function loadData() {
            try {
                showMessage('æ­£åœ¨åŠ è½½æ•°æ®...', 'info');
                const response = await fetch(`${API_BASE_URL}/resume/all`);

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }

                const data = await response.json();
                allResumes = data;
                filteredResumes = [...allResumes];

                renderResumeGrid();
                updateFilters();
                showMessage('æ•°æ®åŠ è½½æˆåŠŸ', 'success');

            } catch (error) {
                console.error('åŠ è½½æ•°æ®å¤±è´¥:', error);
                showMessage('æ•°æ®åŠ è½½å¤±è´¥: ' + error.message, 'error');
                const gridElement = document.getElementById('resumeGrid');
                if (gridElement) {
                    gridElement.innerHTML = `
                        <div style="grid-column: 1 / -1; text-align: center; padding: 60px;">
                            <div style="font-size: 48px; margin-bottom: 20px;">âš ï¸</div>
                            <h3>æ•°æ®åŠ è½½å¤±è´¥</h3>
                            <p>è¯·æ£€æŸ¥APIè¿æ¥çŠ¶æ€</p>
                            <button class="action-btn" onclick="loadData()" style="margin-top: 20px;">é‡è¯•</button>
                        </div>
                    `;
                }
            }
        }

        function updateStats() {
            const totalCount = allResumes.length;
            const todayCount = Math.floor(Math.random() * 5);
            const avgSkills = totalCount > 0 ? Math.round(
                allResumes.reduce((sum, resume) =>
                    sum + (resume.skills_objs ? resume.skills_objs.length : 0), 0) / totalCount
            ) : 0;

            const totalElement = document.getElementById('totalResumes');
            const newElement = document.getElementById('newResumes');
            const avgElement = document.getElementById('avgSkills');

            if (totalElement) totalElement.textContent = totalCount;
            if (newElement) newElement.textContent = todayCount;
            if (avgElement) avgElement.textContent = avgSkills;
        }

        function renderResumeGrid() {
            const grid = document.getElementById('resumeGrid');
            if (!grid) return;

            if (filteredResumes.length === 0) {
                grid.innerHTML = `
                    <div style="grid-column: 1 / -1; text-align: center; padding: 60px;">
                        <div style="font-size: 48px; margin-bottom: 20px;">ğŸ“‹</div>
                        <h3>æš‚æ— ç®€å†æ•°æ®</h3>
                        <p>è¯·ä¸Šä¼ ç®€å†æˆ–æ£€æŸ¥æœç´¢æ¡ä»¶</p>
                    </div>
                `;
                return;
            }

            grid.innerHTML = filteredResumes.map(resume => `
                <div class="resume-card">
                    <div class="card-header">
                        <div class="avatar">
                            ${resume.name ? resume.name.charAt(0) : 'U'}
                        </div>
                        <div class="card-info">
                            <h3>${resume.name || 'æœªçŸ¥å§“å'}</h3>
                            <p>${resume.major || 'ä¸“ä¸šå¾…æ›´æ–°'}</p>
                        </div>
                    </div>
                    <div class="card-content">
                        <div class="info-row">
                            <span class="info-label">é‚®ç®±:</span>
                            <span class="info-value">${resume.email || 'æœªæä¾›'}</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">ç”µè¯:</span>
                            <span class="info-value">${resume.phone || 'æœªæä¾›'}</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">å­¦æ ¡:</span>
                            <span class="info-value">${resume.college || 'æœªæä¾›'}</span>
                        </div>
                        ${resume.skills_objs && resume.skills_objs.length > 0 ? `
                            <div class="skills-tags">
                                ${resume.skills_objs.slice(0, 3).map(skill =>
                                    `<span class="skill-tag">${skill.skills_name}</span>`
                                ).join('')}
                                ${resume.skills_objs.length > 3 ?
                                    `<span class="skill-tag">+${resume.skills_objs.length - 3}</span>` : ''}
                            </div>
                        ` : ''}
                    </div>
                    <div class="card-actions">
                        <button class="btn-small primary" onclick="viewDetails('${resume._id}')">æŸ¥çœ‹è¯¦æƒ…</button>
                        <button class="btn-small" onclick="editResume('${resume._id}')">ç¼–è¾‘</button>
                        <button class="btn-small danger" onclick="deleteResume('${resume._id}')">åˆ é™¤</button>
                    </div>
                </div>
            `).join('');
        }

        function updateFilters() {
            const skillFilter = document.getElementById('skillFilter');
            const eduFilter = document.getElementById('eduFilter');

            if (!skillFilter || !eduFilter) return;

            const allSkills = new Set();
            allResumes.forEach(resume => {
                if (resume.skills_objs) {
                    resume.skills_objs.forEach(skill => {
                        allSkills.add(skill.skills_name);
                    });
                }
            });

            skillFilter.innerHTML = '<option value="">æ‰€æœ‰æŠ€èƒ½</option>' +
                Array.from(allSkills).map(skill =>
                    `<option value="${skill}">${skill}</option>`
                ).join('');

            const allEducation = new Set();
            allResumes.forEach(resume => {
                if (resume.college) {
                    allEducation.add(resume.college);
                }
            });

            eduFilter.innerHTML = '<option value="">æ‰€æœ‰å­¦æ ¡</option>' +
                Array.from(allEducation).slice(0, 20).map(edu =>
                    `<option value="${edu}">${edu}</option>`
                ).join('');
        }

        function handleSearch() {
            const searchInput = document.getElementById('searchInput');
            if (!searchInput) return;

            const searchTerm = searchInput.value.toLowerCase();

            if (!searchTerm) {
                filteredResumes = [...allResumes];
            } else {
                filteredResumes = allResumes.filter(resume => {
                    return (
                        (resume.name && resume.name.toLowerCase().includes(searchTerm)) ||
                        (resume.college && resume.college.toLowerCase().includes(searchTerm)) ||
                        (resume.email && resume.email.toLowerCase().includes(searchTerm)) ||
                        (resume.skills_objs && resume.skills_objs.some(skill =>
                            skill.skills_name && skill.skills_name.toLowerCase().includes(searchTerm)
                        ))
                    );
                });
            }

            renderResumeGrid();
        }

        // ============ é¡¹ç›®æ–‡ä»¶ç®¡ç† ============
        async function loadProjectFiles() {
            if (!currentProject) {
                showMessage('è¯·å…ˆé€‰æ‹©ä¸€ä¸ªé¡¹ç›®', 'error');
                return;
            }

            try {
                const response = await fetch(`${API_BASE_URL}/projects/${currentProject}/files`);

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }

                const files = await response.json();
                currentProjectFiles = files;

                // è°ƒè¯•ä¿¡æ¯ï¼šæ˜¾ç¤ºä»APIè¿”å›çš„æ–‡ä»¶ä¿¡æ¯
                console.log('ä»APIè·å–çš„é¡¹ç›®æ–‡ä»¶ä¿¡æ¯:');
                files.forEach((file, index) => {
                    console.log(`æ–‡ä»¶ ${index + 1}:`, {
                        original_filename: file.original_filename,
                        filename: file.filename,
                        file_id: file.file_id,
                        size: file.size,
                        mimetype: file.mimetype
                    });
                });

                renderProjectFiles();

                logger.info(`æˆåŠŸåŠ è½½é¡¹ç›®æ–‡ä»¶: ${files.length} ä¸ª`);

            } catch (error) {
                console.error('åŠ è½½é¡¹ç›®æ–‡ä»¶å¤±è´¥:', error);
                showMessage('åŠ è½½é¡¹ç›®æ–‡ä»¶å¤±è´¥: ' + error.message, 'error');
                currentProjectFiles = [];
                renderProjectFiles();
            }
        }

        function renderProjectFiles() {
    const pageElement = document.getElementById('project-upload');
    if (!pageElement) return;

    let fileListContainer = pageElement.querySelector('.file-list-container');
    if (!fileListContainer) {
        fileListContainer = document.createElement('div');
        fileListContainer.className = 'file-list-container';
        pageElement.appendChild(fileListContainer);
    }

    const files = currentProjectFiles || [];
    const project = allProjects.find(p => p._id === currentProject);
    const projectName = project ? project.name : 'å½“å‰é¡¹ç›®';

    if (files.length === 0) {
        fileListContainer.innerHTML = `
            <h3 style="margin-bottom: 10px;">${projectName}çš„æ–‡ä»¶</h3>
            <p style="color: #666;">æš‚æ— æ–‡ä»¶</p>
        `;
        return;
    }

    fileListContainer.innerHTML = `
        <h3 style="margin-bottom: 10px;">${projectName}çš„æ–‡ä»¶ (${files.length}ä¸ª)</h3>
        <div class="file-list">
            ${files.map((file, index) => {
                let displayName = 'æœªçŸ¥æ–‡ä»¶';
                if (file.original_filename && file.original_filename.trim() !== '') {
                    displayName = file.original_filename;
                } else if (file.filename && file.filename.trim() !== '') {
                    displayName = file.filename;
                }

                // è§£æçŠ¶æ€æ˜¾ç¤º
                const parseStatus = file.parse_status || 'pending';
                const parseEnabled = file.parse_enabled !== false;

                let statusBadge = '';
                let statusColor = '';

                switch(parseStatus) {
                    case 'pending':
                        statusBadge = 'æœªè§£æ';
                        statusColor = '#666';
                        break;
                    case 'processing':
                        statusBadge = 'è§£æä¸­';
                        statusColor = '#1a73e8';
                        break;
                    case 'completed':
                        statusBadge = 'å·²è§£æ';
                        statusColor = '#34a853';
                        break;
                    case 'failed':
                        statusBadge = 'è§£æå¤±è´¥';
                        statusColor = '#ea4335';
                        break;
                }

                return `
                <div class="file-card">
                    <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 12px;">
                        <div style="font-size: 24px;">${getFileIcon(file.mimetype)}</div>
                        <div style="flex: 1;">
                            <div style="font-weight: 500; margin-bottom: 4px; word-break: break-all;" title="${displayName}">
                                ${displayName}
                            </div>
                            <div style="font-size: 12px; color: #5f6368;">
                                ${formatFileSize(file.size)} â€¢ ${formatDate(file.upload_date)}
                            </div>
                            <div style="display: flex; align-items: center; gap: 12px; margin-top: 8px;">
                                <div style="display: flex; align-items: center; gap: 8px;">
                                    <span style="font-size: 12px; color: #5f6368;">å¯ç”¨è§£æ:</span>
                                    <label class="switch" style="position: relative; display: inline-block; width: 34px; height: 20px;border-radius: 20px;background: grey;">
                                        <input type="checkbox" ${parseEnabled ? 'checked' : ''} onchange="toggleParseEnabled('${file.file_id}', this.checked)">
                                        <span class="slider" style="position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; transition: .4s; border-radius: 20px;"></span>
                                    </label>
                                </div>
                                <div style="display: flex; align-items: center; gap: 4px;">
                                    <span style="font-size: 12px; color: #5f6368;">è§£æçŠ¶æ€:</span>
                                    <span style="font-size: 12px; color: ${statusColor}; font-weight: 500;">${statusBadge}</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div style="display: flex; gap: 8px;">
                        <button class="btn-small primary" onclick="parseFile('${file.file_id}', '${displayName.replace(/'/g, "\\'")}')">
                            ${parseStatus === 'processing' ? 'è§£æä¸­...' : 'è§£æ'}
                        </button>
                        <button class="btn-small primary" onclick="downloadFile('${file.file_id}', '${displayName.replace(/'/g, "\\'")}')">
                            ä¸‹è½½
                        </button>
                        <button class="btn-small danger" onclick="deleteProjectFile('${file.file_id}', '${displayName.replace(/'/g, "\\'")}')">
                            åˆ é™¤
                        </button>
                    </div>
                </div>
            `}).join('')}
        </div>
    `;
}

// æ·»åŠ åˆ‡æ¢è§£æçŠ¶æ€çš„å‡½æ•°
async function toggleParseEnabled(fileId, enabled) {
    try {
        const response = await fetch(`${API_BASE_URL}/files/${fileId}/parse-status`, {
            method: 'PUT',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                parse_enabled: enabled
            })
        });

        const result = await response.json();

        if (response.ok) {
            showMessage(`è§£æçŠ¶æ€å·²${enabled ? 'å¯ç”¨' : 'ç¦ç”¨'}`, 'success');
            await loadProjectFiles(); // åˆ·æ–°æ–‡ä»¶åˆ—è¡¨
        } else {
            showMessage(result.error || 'æ›´æ–°å¤±è´¥', 'error');
        }
    } catch (error) {
        console.error('æ›´æ–°è§£æçŠ¶æ€å¤±è´¥:', error);
        showMessage('æ›´æ–°è§£æçŠ¶æ€å¤±è´¥: ' + error.message, 'error');
    }
}

// æ·»åŠ è§£ææ–‡ä»¶çš„å‡½æ•°
async function parseFile(fileId, filename) {
    try {
        showMessage(`å¼€å§‹è§£ææ–‡ä»¶: ${filename}`, 'info');
        // è°ƒç”¨åç«¯è§£æAPI
        const response = await fetch(`${API_BASE_URL}/files/${fileId}/parse`, {
            method: 'POST',
        });
        const result = await response.json();
        if (response.ok) {
            showMessage(`æ–‡ä»¶è§£æå®Œæˆ: ${filename}`, 'success');
        } else {
            showMessage(result.error || 'è§£æå¤±è´¥', 'error');
        }
        await loadProjectFiles(); // åˆ·æ–°æ˜¾ç¤º
    } catch (error) {
        console.error('è§£ææ–‡ä»¶å¤±è´¥:', error);
        showMessage('è§£ææ–‡ä»¶å¤±è´¥: ' + error.message, 'error');
    }
}

        async function uploadProjectFiles(files) {
            if (!currentProject) {
                showMessage('è¯·å…ˆé€‰æ‹©ä¸€ä¸ªé¡¹ç›®', 'error');
                return false;
            }

            try {
                const formData = new FormData();

                // æ·»åŠ è°ƒè¯•ä¿¡æ¯ï¼šæ˜¾ç¤ºè¦ä¸Šä¼ çš„æ–‡ä»¶
                console.log('=== å‡†å¤‡ä¸Šä¼ é¡¹ç›®æ–‡ä»¶ ===');
                for (let i = 0; i < files.length; i++) {
                    formData.append('files', files[i]);
                    console.log(`ä¸Šä¼ æ–‡ä»¶ ${i + 1}: "${files[i].name}" (${formatFileSize(files[i].size)})`);
                }

                showUploadProgress('project', true);

                const response = await fetch(`${API_BASE_URL}/projects/${currentProject}/files`, {
                    method: 'POST',
                    body: formData
                });

                const result = await response.json();

                // æ·»åŠ è°ƒè¯•ä¿¡æ¯ï¼šæ˜¾ç¤ºæœåŠ¡å™¨è¿”å›ç»“æœ
                console.log('=== æœåŠ¡å™¨ä¸Šä¼ å“åº” ===');
                console.log('å“åº”çŠ¶æ€:', response.status);
                console.log('å“åº”æ•°æ®:', result);

                showUploadProgress('project', false);

                if (response.ok) {
                    const successCount = result.uploaded_files ? result.uploaded_files.length : 0;
                    let message = `æˆåŠŸä¸Šä¼  ${successCount} ä¸ªæ–‡ä»¶åˆ°é¡¹ç›®`;

                    if (result.project_name) {
                        message += `: ${result.project_name}`;
                    }

                    // æ˜¾ç¤ºæ¯ä¸ªä¸Šä¼ æ–‡ä»¶çš„è¯¦ç»†ä¿¡æ¯
                    if (result.uploaded_files) {
                        console.log('=== ä¸Šä¼ æˆåŠŸçš„æ–‡ä»¶è¯¦æƒ… ===');
                        result.uploaded_files.forEach((file, index) => {
                            console.log(`æ–‡ä»¶ ${index + 1}:`, {
                                original_filename: file.original_filename,
                                filename: file.filename,
                                file_id: file.file_id,
                                size: file.size
                            });
                        });
                    }

                    if (result.errors && result.errors.length > 0) {
                        message += `ï¼Œ${result.errors.length} ä¸ªæ–‡ä»¶å¤±è´¥`;
                        console.warn('ä¸Šä¼ é”™è¯¯:', result.errors);
                    }

                    showMessage(message, 'success');

                    // é‡æ–°åŠ è½½é¡¹ç›®æ–‡ä»¶åˆ—è¡¨
                    await loadProjectFiles();

                    return true;
                } else {
                    console.error('ä¸Šä¼ å¤±è´¥:', result);
                    showMessage(result.error || 'æ–‡ä»¶ä¸Šä¼ å¤±è´¥', 'error');
                    return false;
                }

            } catch (error) {
                showUploadProgress('project', false);
                console.error('æ–‡ä»¶ä¸Šä¼ å¤±è´¥:', error);
                showMessage('æ–‡ä»¶ä¸Šä¼ å¤±è´¥: ' + error.message, 'error');
                return false;
            }
        }

        async function deleteProjectFile(fileId, filename) {
            try {
                if (!confirm(`ç¡®å®šè¦åˆ é™¤æ–‡ä»¶ "${filename}" å—ï¼Ÿ`)) {
                    return;
                }

                const response = await fetch(`${API_BASE_URL}/files/${fileId}`, {
                    method: 'DELETE'
                });

                const result = await response.json();

                if (response.ok) {
                    showMessage(`æ–‡ä»¶ "${filename}" åˆ é™¤æˆåŠŸ`, 'success');

                    // é‡æ–°åŠ è½½é¡¹ç›®æ–‡ä»¶åˆ—è¡¨
                    await loadProjectFiles();
                } else {
                    showMessage(result.error || 'åˆ é™¤æ–‡ä»¶å¤±è´¥', 'error');
                }

            } catch (error) {
                console.error('åˆ é™¤æ–‡ä»¶å¤±è´¥:', error);
                showMessage('åˆ é™¤æ–‡ä»¶å¤±è´¥: ' + error.message, 'error');
            }
        }

        // ============ åˆ†ç±»æ–‡ä»¶ç®¡ç† ============
        async function loadCategoryFiles(category) {
            try {
                const response = await fetch(`${API_BASE_URL}/files/category/${category}`);

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }

                const files = await response.json();
                currentCategoryFiles[category] = files;

                // è°ƒè¯•ä¿¡æ¯ï¼šæ˜¾ç¤ºä»APIè¿”å›çš„æ–‡ä»¶ä¿¡æ¯
                console.log(`ä»APIè·å–çš„${FILE_CATEGORIES[category]}æ–‡ä»¶ä¿¡æ¯:`);
                files.forEach((file, index) => {
                    console.log(`æ–‡ä»¶ ${index + 1}:`, {
                        original_filename: file.original_filename,
                        filename: file.filename,
                        file_id: file.file_id,
                        size: file.size,
                        mimetype: file.mimetype
                    });
                });

                renderCategoryFiles(category);

                logger.info(`æˆåŠŸåŠ è½½ ${category} ç±»åˆ«æ–‡ä»¶: ${files.length} ä¸ª`);

            } catch (error) {
                console.error(`åŠ è½½ ${category} æ–‡ä»¶å¤±è´¥:`, error);
                showMessage(`åŠ è½½${FILE_CATEGORIES[category]}æ–‡ä»¶å¤±è´¥: ` + error.message, 'error');
                currentCategoryFiles[category] = [];
            }
        }

        function renderCategoryFiles(category) {
            const pageElement = document.getElementById(`upload-${category}`);
            if (!pageElement) return;

            let fileListContainer = pageElement.querySelector('.file-list-container');
            if (!fileListContainer) {
                fileListContainer = document.createElement('div');
                fileListContainer.className = 'file-list-container';
                pageElement.appendChild(fileListContainer);
            }

            const files = currentCategoryFiles[category] || [];
            const categoryName = FILE_CATEGORIES[category];

            if (files.length === 0) {
                fileListContainer.innerHTML = `
                    <h3 style="margin-bottom: 10px;">å·²ä¸Šä¼ çš„${categoryName}æ–‡ä»¶</h3>
                    <p style="color: #666;">æš‚æ— ${categoryName}æ–‡ä»¶</p>
                `;
                return;
            }

            console.log(`=== æ¸²æŸ“${categoryName}æ–‡ä»¶åˆ—è¡¨ ===`);
            fileListContainer.innerHTML = `
                <h3 style="margin-bottom: 10px;">å·²ä¸Šä¼ çš„${categoryName}æ–‡ä»¶ (${files.length}ä¸ª)</h3>
                <div class="file-list">
                    ${files.map((file, index) => {
                        // æ›´è¯¦ç»†çš„æ–‡ä»¶åå¤„ç†é€»è¾‘
                        let displayName = 'æœªçŸ¥æ–‡ä»¶';

                        if (file.original_filename && file.original_filename.trim() !== '') {
                            displayName = file.original_filename;
                        } else if (file.filename && file.filename.trim() !== '') {
                            displayName = file.filename;
                        }

                        // è°ƒè¯•ä¿¡æ¯
                        console.log(`æ¸²æŸ“${categoryName}æ–‡ä»¶ ${index + 1}:`, {
                            original_filename: file.original_filename,
                            filename: file.filename,
                            displayName: displayName,
                            file_id: file.file_id
                        });

                        return `
                        <div class="file-card">
                            <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 12px;">
                                <div style="font-size: 24px;">${getFileIcon(file.mimetype)}</div>
                                <div style="flex: 1;">
                                    <div style="font-weight: 500; margin-bottom: 4px; word-break: break-all;" title="${displayName}">
                                        ${displayName}
                                    </div>
                                    <div style="font-size: 12px; color: #5f6368;">
                                        ${formatFileSize(file.size)} â€¢ ${formatDate(file.upload_date)}
                                    </div>
                                    ${file.original_filename && file.filename && file.original_filename !== file.filename ? `
                                        <div style="font-size: 10px; color: #888; margin-top: 2px;">
                                            å­˜å‚¨ä¸º: ${file.filename}
                                        </div>
                                    ` : ''}
                                    <!-- è°ƒè¯•ä¿¡æ¯æ˜¾ç¤º -->
                                    <div style="font-size: 9px; color: #ccc; margin-top: 1px;">
                                        ID: ${file.file_id} | Original: ${file.original_filename || 'null'} | Storage: ${file.filename || 'null'}
                                    </div>
                                </div>
                            </div>
                            <div style="display: flex; gap: 8px;">
                                <button class="btn-small primary" onclick="downloadFile('${file.file_id}', '${displayName.replace(/'/g, "\\'")}')">
                                    ä¸‹è½½
                                </button>
                                <button class="btn-small danger" onclick="deleteFile('${file.file_id}', '${displayName.replace(/'/g, "\\'")}', '${category}')">
                                    åˆ é™¤
                                </button>
                            </div>
                        </div>
                    `}).join('')}
                </div>
            `;
        }

        async function uploadCategoryFiles(files, category) {
            try {
                const formData = new FormData();

                // æ·»åŠ è°ƒè¯•ä¿¡æ¯ï¼šæ˜¾ç¤ºè¦ä¸Šä¼ çš„æ–‡ä»¶
                console.log(`=== å‡†å¤‡ä¸Šä¼ ${FILE_CATEGORIES[category]}æ–‡ä»¶ ===`);
                for (let i = 0; i < files.length; i++) {
                    formData.append('files', files[i]);
                    console.log(`ä¸Šä¼ æ–‡ä»¶ ${i + 1}: "${files[i].name}" (${formatFileSize(files[i].size)})`);
                }

                showUploadProgress(category, true);

                const response = await fetch(`${API_BASE_URL}/files/category/${category}`, {
                    method: 'POST',
                    body: formData
                });

                const result = await response.json();

                // æ·»åŠ è°ƒè¯•ä¿¡æ¯ï¼šæ˜¾ç¤ºæœåŠ¡å™¨è¿”å›ç»“æœ
                console.log(`=== ${FILE_CATEGORIES[category]}ä¸Šä¼ å“åº” ===`);
                console.log('å“åº”çŠ¶æ€:', response.status);
                console.log('å“åº”æ•°æ®:', result);

                showUploadProgress(category, false);

                if (response.ok) {
                    const successCount = result.uploaded_files ? result.uploaded_files.length : 0;
                    let message = `æˆåŠŸä¸Šä¼  ${successCount} ä¸ªæ–‡ä»¶åˆ°${FILE_CATEGORIES[category]}`;

                    // æ˜¾ç¤ºæ¯ä¸ªä¸Šä¼ æ–‡ä»¶çš„è¯¦ç»†ä¿¡æ¯
                    if (result.uploaded_files) {
                        console.log(`=== ${FILE_CATEGORIES[category]}ä¸Šä¼ æˆåŠŸçš„æ–‡ä»¶è¯¦æƒ… ===`);
                        result.uploaded_files.forEach((file, index) => {
                            console.log(`æ–‡ä»¶ ${index + 1}:`, {
                                original_filename: file.original_filename,
                                filename: file.filename,
                                file_id: file.file_id,
                                size: file.size
                            });
                        });
                    }

                    if (result.errors && result.errors.length > 0) {
                        message += `ï¼Œ${result.errors.length} ä¸ªæ–‡ä»¶å¤±è´¥`;
                        console.warn('ä¸Šä¼ é”™è¯¯:', result.errors);
                    }

                    showMessage(message, 'success');

                    // é‡æ–°åŠ è½½æ–‡ä»¶åˆ—è¡¨
                    await loadCategoryFiles(category);

                    return true;
                } else {
                    console.error('ä¸Šä¼ å¤±è´¥:', result);
                    showMessage(result.error || 'æ–‡ä»¶ä¸Šä¼ å¤±è´¥', 'error');
                    return false;
                }

            } catch (error) {
                showUploadProgress(category, false);
                console.error('æ–‡ä»¶ä¸Šä¼ å¤±è´¥:', error);
                showMessage('æ–‡ä»¶ä¸Šä¼ å¤±è´¥: ' + error.message, 'error');
                return false;
            }
        }

        function showUploadProgress(category, show) {
            const progressElement = document.getElementById(`uploadProgress-${category}`);
            if (progressElement) {
                progressElement.style.display = show ? 'block' : 'none';
            }
        }

        function getFileIcon(mimetype) {
            if (!mimetype) return 'ğŸ“„';

            if (mimetype.startsWith('image/')) return 'ğŸ–¼ï¸';
            if (mimetype.startsWith('video/')) return 'ğŸ¥';
            if (mimetype.startsWith('audio/')) return 'ğŸµ';
            if (mimetype.includes('pdf')) return 'ğŸ“‘';
            if (mimetype.includes('word') || mimetype.includes('document')) return 'ğŸ“';
            if (mimetype.includes('excel') || mimetype.includes('spreadsheet')) return 'ğŸ“Š';
            if (mimetype.includes('powerpoint') || mimetype.includes('presentation')) return 'ğŸ“ˆ';
            if (mimetype.includes('zip') || mimetype.includes('rar') || mimetype.includes('7z')) return 'ğŸ—œï¸';
            if (mimetype.includes('text')) return 'ğŸ“„';

            return 'ğŸ“„';
        }

        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';

            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));

            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        function formatDate(dateString) {
            try {
                const date = new Date(dateString);
                return date.toLocaleDateString('zh-CN', {
                    year: 'numeric',
                    month: '2-digit',
                    day: '2-digit',
                    hour: '2-digit',
                    minute: '2-digit'
                });
            } catch (error) {
                return dateString;
            }
        }

        async function downloadFile(fileId, filename) {
            try {
                const response = await fetch(`${API_BASE_URL}/files/${fileId}/download`);

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.error || 'ä¸‹è½½å¤±è´¥');
                }

                const blob = await response.blob();
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = filename;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                window.URL.revokeObjectURL(url);

                showMessage(`æ–‡ä»¶ "${filename}" ä¸‹è½½å®Œæˆ`, 'success');

            } catch (error) {
                console.error('æ–‡ä»¶ä¸‹è½½å¤±è´¥:', error);
                showMessage('æ–‡ä»¶ä¸‹è½½å¤±è´¥: ' + error.message, 'error');
            }
        }

        async function deleteFile(fileId, filename, category) {
            try {
                if (!confirm(`ç¡®å®šè¦åˆ é™¤æ–‡ä»¶ "${filename}" å—ï¼Ÿ`)) {
                    return;
                }

                const response = await fetch(`${API_BASE_URL}/files/${fileId}`, {
                    method: 'DELETE'
                });

                const result = await response.json();

                if (response.ok) {
                    showMessage(`æ–‡ä»¶ "${filename}" åˆ é™¤æˆåŠŸ`, 'success');

                    // é‡æ–°åŠ è½½æ–‡ä»¶åˆ—è¡¨
                    if (category) {
                        await loadCategoryFiles(category);
                    }
                } else {
                    showMessage(result.error || 'åˆ é™¤æ–‡ä»¶å¤±è´¥', 'error');
                }

            } catch (error) {
                console.error('åˆ é™¤æ–‡ä»¶å¤±è´¥:', error);
                showMessage('åˆ é™¤æ–‡ä»¶å¤±è´¥: ' + error.message, 'error');
            }
        }

        // ============ æ–‡ä»¶ä¸Šä¼ å¤„ç† ============
        function handleDragOver(e) {
            e.preventDefault();
            e.currentTarget.classList.add('dragover');
        }

        function handleDragLeave(e) {
            e.preventDefault();
            e.currentTarget.classList.remove('dragover');
        }

        function handleDrop(e, category) {
            e.preventDefault();
            e.currentTarget.classList.remove('dragover');
            const files = e.dataTransfer.files;
            handleFiles(files, category);
        }

        function handleFileSelect(e, category) {
            const files = e.target.files;
            handleFiles(files, category);
        }

        function handleFiles(files, category) {
            if (files.length === 0) return;

            // æ£€æŸ¥æ–‡ä»¶æ•°é‡
            if (files.length > 50) {
                showMessage('ä¸€æ¬¡æœ€å¤šä¸Šä¼ 50ä¸ªæ–‡ä»¶', 'error');
                return;
            }

            // æ£€æŸ¥æ–‡ä»¶å¤§å°
            const maxSize = 100 * 1024 * 1024; // 100MB
            const oversizedFiles = [];

            for (let i = 0; i < files.length; i++) {
                if (files[i].size > maxSize) {
                    oversizedFiles.push(files[i].name);
                }
            }

            if (oversizedFiles.length > 0) {
                showMessage(`ä»¥ä¸‹æ–‡ä»¶è¿‡å¤§ï¼ˆè¶…è¿‡100MBï¼‰ï¼š${oversizedFiles.join(', ')}`, 'error');
                return;
            }

            // è°ƒè¯•ä¿¡æ¯ï¼šæ˜¾ç¤ºæ–‡ä»¶åŸå§‹åç§°
            console.log('å‡†å¤‡ä¸Šä¼ çš„æ–‡ä»¶:');
            for (let i = 0; i < files.length; i++) {
                console.log(`æ–‡ä»¶ ${i + 1}: ${files[i].name} (${formatFileSize(files[i].size)})`);
            }

            // æ ¹æ®ç±»åˆ«ä¸Šä¼ æ–‡ä»¶
            if (category === 'project') {
                uploadProjectFiles(files);
            } else {
                uploadCategoryFiles(files, category);
            }
        }

        function viewDetails(id) {
            const resume = allResumes.find(r => r._id === id);
            if (!resume) return;

            document.getElementById('modalTitle').textContent = `${resume.name || 'æœªçŸ¥å§“å'} - è¯¦ç»†ä¿¡æ¯`;
            document.getElementById('modalBody').innerHTML = generateDetailHTML(resume);
            document.getElementById('detailModal').style.display = 'flex';
        }

        function generateDetailHTML(resume) {
            return `
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px; margin-bottom: 30px;">
                    <div>
                        <h4 style="margin-bottom: 15px; color: #1a73e8;">åŸºæœ¬ä¿¡æ¯</h4>
                        <div class="info-row"><strong>å§“å:</strong> ${resume.name || 'N/A'}</div>
                        <div class="info-row"><strong>æ€§åˆ«:</strong> ${resume.gender || 'N/A'}</div>
                        <div class="info-row"><strong>å¹´é¾„:</strong> ${resume.age || 'N/A'}</div>
                        <div class="info-row"><strong>é‚®ç®±:</strong> ${resume.email || 'N/A'}</div>
                        <div class="info-row"><strong>ç”µè¯:</strong> ${resume.phone || 'N/A'}</div>
                        <div class="info-row"><strong>åœ°å€:</strong> ${resume.living_address || 'N/A'}</div>
                    </div>
                    <div>
                        <h4 style="margin-bottom: 15px; color: #1a73e8;">æ•™è‚²èƒŒæ™¯</h4>
                        <div class="info-row"><strong>å­¦æ ¡:</strong> ${resume.college || 'N/A'}</div>
                        <div class="info-row"><strong>ä¸“ä¸š:</strong> ${resume.major || 'N/A'}</div>
                        <div class="info-row"><strong>å­¦å†:</strong> ${resume.education || 'N/A'}</div>
                    </div>
                </div>

                ${resume.skills_objs && resume.skills_objs.length > 0 ? `
                    <div style="margin-bottom: 30px;">
                        <h4 style="margin-bottom: 15px; color: #1a73e8;">æŠ€èƒ½åˆ—è¡¨</h4>
                        <div class="skills-tags">
                            ${resume.skills_objs.map(skill =>
                                `<span class="skill-tag">${skill.skills_name} - ${skill.skills_level || ''}</span>`
                            ).join('')}
                        </div>
                    </div>
                ` : ''}

                ${resume.job_exp_objs && resume.job_exp_objs.length > 0 ? `
                    <div style="margin-bottom: 30px;">
                        <h4 style="margin-bottom: 15px; color: #1a73e8;">å·¥ä½œç»å†</h4>
                        ${resume.job_exp_objs.map(job => `
                            <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                                <div style="font-weight: 600;">${job.job_position} @ ${job.job_cpy}</div>
                                <div style="color: #5f6368; margin: 5px 0;">${job.start_date} - ${job.end_date}</div>
                                <div style="line-height: 1.6;">${job.job_content || ''}</div>
                            </div>
                        `).join('')}
                    </div>
                ` : ''}
            `;
        }

        function editResume(id) {
            showMessage('ç¼–è¾‘åŠŸèƒ½å¼€å‘ä¸­...', 'info');
        }

        function deleteResume(id) {
            if (confirm('ç¡®å®šè¦åˆ é™¤è¿™ä»½ç®€å†å—ï¼Ÿ')) {
                showMessage('åˆ é™¤åŠŸèƒ½å¼€å‘ä¸­...', 'info');
            }
        }

        function closeModal() {
            document.getElementById('detailModal').style.display = 'none';
        }

        function showProjectManager() {
            renderProjectManagerList();
            document.getElementById('projectManagerModal').style.display = 'flex';
        }

        function closeProjectManager() {
            document.getElementById('projectManagerModal').style.display = 'none';
            document.getElementById('newProjectNameInput').value = '';
            document.getElementById('newProjectDescInput').value = '';
        }

        function renderProjectManagerList() {
            const listContainer = document.getElementById('projectManagerList');
            if (!listContainer) return;

            if (allProjects.length === 0) {
                listContainer.innerHTML = '<p style="color: #666; text-align: center; padding: 20px;">æš‚æ— é¡¹ç›®</p>';
                return;
            }

            listContainer.innerHTML = allProjects.map(project => `
                <div style="display: flex; align-items: center; justify-content: space-between; padding: 12px; border: 1px solid #e8eaed; border-radius: 6px; margin-bottom: 8px; ${project._id === currentProject ? 'background: #e8f0fe; border-color: #1a73e8;' : ''}">
                    <div style="flex: 1;">
                        <div style="font-weight: 500; margin-bottom: 2px;">${project.name}</div>
                        <div style="font-size: 12px; color: #5f6368;">${project.description || 'æš‚æ— æè¿°'}</div>
                        <div style="font-size: 11px; color: #5f6368; margin-top: 2px;">åˆ›å»ºæ—¶é—´: ${formatDate(project.created_at)}</div>
                    </div>
                    <div style="display: flex; gap: 8px;">
                        ${project._id === currentProject ? '<span style="color: #1a73e8; font-size: 12px; margin-right: 8px;">å½“å‰</span>' : ''}
                        <button class="btn-small" onclick="switchProject('${project._id}')" ${project._id === currentProject ? 'disabled' : ''}>
                            ${project._id === currentProject ? 'å·²é€‰æ‹©' : 'é€‰æ‹©'}
                        </button>
                        <button class="btn-small danger" onclick="deleteProject('${project._id}')">åˆ é™¤</button>
                    </div>
                </div>
            `).join('');
        }

        async function createProjectFromModal() {
            const nameInput = document.getElementById('newProjectNameInput');
            const descInput = document.getElementById('newProjectDescInput');

            const name = nameInput.value.trim();
            const description = descInput.value.trim();

            if (!name) {
                showMessage('è¯·è¾“å…¥é¡¹ç›®åç§°', 'error');
                nameInput.focus();
                return;
            }

            const success = await createProject(name, description);
            if (success) {
                nameInput.value = '';
                descInput.value = '';
                renderProjectManagerList();
            }
        }

        async function deleteProject(projectId) {
            try {
                const project = allProjects.find(p => p._id === projectId);
                const projectName = project ? project.name : 'é¡¹ç›®';

                if (!confirm(`ç¡®å®šè¦åˆ é™¤é¡¹ç›® "${projectName}" å—ï¼Ÿ\n\nåˆ é™¤åå°†åŒæ—¶åˆ é™¤é¡¹ç›®ä¸­çš„æ‰€æœ‰æ–‡ä»¶ï¼Œæ­¤æ“ä½œä¸å¯æ¢å¤ã€‚`)) {
                    return false;
                }

                const response = await fetch(`${API_BASE_URL}/projects/${projectId}`, {
                    method: 'DELETE'
                });

                const result = await response.json();

                if (response.ok) {
                    showMessage(`é¡¹ç›® "${projectName}" åˆ é™¤æˆåŠŸ`, 'success');

                    if (currentProject === projectId) {
                        currentProject = null;
                    }

                    await loadProjects();

                    if (allProjects.length > 0) {
                        switchProject(allProjects[0]._id);
                    } else {
                        currentProject = null;
                        switchPage('dashboard');
                    }

                    return true;
                } else {
                    showMessage(result.error || 'åˆ é™¤é¡¹ç›®å¤±è´¥', 'error');
                    return false;
                }

            } catch (error) {
                console.error('åˆ é™¤é¡¹ç›®å¤±è´¥:', error);
                showMessage('åˆ é™¤é¡¹ç›®å¤±è´¥: ' + error.message, 'error');
                return false;
            }
        }

        async function testConnection() {
            try {
                showMessage('æ­£åœ¨æµ‹è¯•è¿æ¥...', 'info');
                const response = await fetch(`${API_BASE_URL}/health`);

                if (response.ok) {
                    showMessage('APIè¿æ¥æ­£å¸¸', 'success');
                } else {
                    showMessage('APIè¿æ¥å¤±è´¥', 'error');
                }
            } catch (error) {
                showMessage('è¿æ¥æµ‹è¯•å¤±è´¥: ' + error.message, 'error');
            }
        }

        async function testAllEndpoints() {
            const endpoints = [
                { url: `${API_BASE_URL}/health`, name: 'å¥åº·æ£€æŸ¥' },
                { url: `${API_BASE_URL}/resume/all`, name: 'è·å–æ‰€æœ‰ç®€å†' },
                { url: `${API_BASE_URL}/resume/latest`, name: 'è·å–æœ€æ–°ç®€å†' },
                { url: `${API_BASE_URL}/projects`, name: 'è·å–é¡¹ç›®åˆ—è¡¨' },
                { url: `${API_BASE_URL}/system/info`, name: 'ç³»ç»Ÿä¿¡æ¯' }
            ];

            for (const endpoint of endpoints) {
                try {
                    const response = await fetch(endpoint.url);
                    const status = response.ok ? 'âœ…' : 'âŒ';
                    showMessage(`${status} ${endpoint.name}: ${response.status}`, response.ok ? 'success' : 'error');
                } catch (error) {
                    showMessage(`âŒ ${endpoint.name}: è¿æ¥å¤±è´¥`, 'error');
                }
                await new Promise(resolve => setTimeout(resolve, 1000));
            }
        }

        async function getSystemInfo() {
            try {
                const response = await fetch(`${API_BASE_URL}/system/info`);
                const data = await response.json();

                if (response.ok) {
                    let infoHtml = `
                        <h4>ç³»ç»Ÿä¿¡æ¯</h4>
                        <div class="info-row"><strong>æ•°æ®ç›®å½•:</strong> ${data.data_directory}</div>
                        <div class="info-row"><strong>é¡¹ç›®æ•°é‡:</strong> ${data.project_count}</div>
                        <div class="info-row"><strong>é¡¹ç›®æ–‡ä»¶æ•°:</strong> ${data.project_file_count}</div>
                        <div class="info-row"><strong>ç£ç›˜ä½¿ç”¨:</strong> ${data.total_disk_usage_mb} MB</div>
                        <br>
                        <h4>æ–‡ä»¶åˆ†ç±»ç»Ÿè®¡</h4>
                    `;

                    Object.entries(data.file_categories).forEach(([category, info]) => {
                        infoHtml += `<div class="info-row"><strong>${info.name}:</strong> ${info.count} ä¸ªæ–‡ä»¶</div>`;
                    });

                    document.getElementById('modalTitle').textContent = 'ç³»ç»Ÿä¿¡æ¯';
                    document.getElementById('modalBody').innerHTML = infoHtml;
                    document.getElementById('detailModal').style.display = 'flex';
                } else {
                    showMessage('è·å–ç³»ç»Ÿä¿¡æ¯å¤±è´¥', 'error');
                }
            } catch (error) {
                showMessage('è·å–ç³»ç»Ÿä¿¡æ¯å¤±è´¥: ' + error.message, 'error');
            }
        }

        async function refreshData() {
            await loadData();
            updateStats();

            // åˆ·æ–°å½“å‰é¡µé¢çš„æ–‡ä»¶åˆ—è¡¨
            if (currentPage.startsWith('upload-')) {
                const category = currentPage.replace('upload-', '');
                if (FILE_CATEGORIES[category]) {
                    loadCategoryFiles(category);
                }
            } else if (currentPage === 'project-upload') {
                loadProjectFiles();
            }
        }

        function exportData() {
            const dataStr = JSON.stringify(filteredResumes, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            const link = document.createElement('a');
            link.href = URL.createObjectURL(dataBlob);
            link.download = `ç®€å†æ•°æ®_${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            showMessage('æ•°æ®å¯¼å‡ºæˆåŠŸ', 'success');
        }

        function loadResumeManagement() {
            const managementGrid = document.getElementById('resumeManagementGrid');
            const originalGrid = document.getElementById('resumeGrid');
            if (managementGrid && originalGrid) {
                managementGrid.innerHTML = originalGrid.innerHTML;
            }
        }

        async function checkConnectionStatus() {
            try {
                const response = await fetch(`${API_BASE_URL}/health`);
                const statusElement = document.getElementById('connectionStatus');

                if (statusElement) {
                    if (response.ok) {
                        statusElement.textContent = 'âœ… è¿æ¥æ­£å¸¸';
                        statusElement.style.color = '#34a853';
                    } else {
                        statusElement.textContent = 'âŒ è¿æ¥å¼‚å¸¸';
                        statusElement.style.color = '#ea4335';
                    }
                }
            } catch (error) {
                const statusElement = document.getElementById('connectionStatus');
                if (statusElement) {
                    statusElement.textContent = 'âŒ è¿æ¥å¤±è´¥';
                    statusElement.style.color = '#ea4335';
                }
            }
        }

        function showMessage(message, type) {
            const messageElement = document.getElementById('statusMessage');
            messageElement.textContent = message;
            messageElement.className = `status-message ${type} show`;

            setTimeout(() => {
                messageElement.classList.remove('show');
            }, 3000);
        }

        // é”®ç›˜å¿«æ·é”®
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                closeModal();
            }
            if (e.ctrlKey && e.key === 'r') {
                e.preventDefault();
                refreshData();
            }
        });
    </script>
</body>
</html>