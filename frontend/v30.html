<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AIç®€å†åˆ†æç³»ç»Ÿ</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <div class="container">
        <!-- å·¦ä¾§å·¥ä½œå° -->
        <div class="workspace">
            <div class="workspace-header">
                <div class="workspace-title">å·¥ä½œå°</div>
                <div class="workspace-subtitle">AIç®€å†åˆ†æç³»ç»Ÿ</div>
            </div>

            <div class="workspace-content">
                <!-- æˆ‘çš„é¡¹ç›® -->
                <div class="workspace-section">
                    <div class="section-header" data-section="projects">
                        <span>æˆ‘çš„é¡¹ç›®</span>
                        <span class="expand-icon">â–¼</span>
                    </div>
                    <div class="section-content" id="projectsSection">
                        <div class="add-project" onclick="showNewProjectInput()">
                            <span>+ æ–°å»ºé¡¹ç›®</span>
                        </div>
                        <div class="new-project-input" id="newProjectInput">
                            <input type="text" placeholder="è¾“å…¥é¡¹ç›®åç§°" onkeypress="handleNewProject(event)">
                        </div>
                    </div>
                </div>

                <!-- APIæ¥å£æµ‹è¯• -->
                <div class="workspace-section">
                    <div class="section-header" data-section="api">
                        <span>æµ‹è¯•æ–°çš„APIæ¥å£</span>
                        <span class="expand-icon">â–¼</span>
                    </div>
                    <div class="section-content" id="apiSection">
                        <div class="nav-item" data-page="api-test">
                            <span class="nav-icon">ğŸ”§</span>
                            <span>APIæµ‹è¯•</span>
                        </div>
                        <div class="nav-item" data-page="api-config">
                            <span class="nav-icon">âš™ï¸</span>
                            <span>æ¥å£é…ç½®</span>
                        </div>
                    </div>
                </div>

                <!-- AIå¯¹è¯ -->
                <div class="workspace-section">
                    <div class="section-header" data-section="ai">
                        <span>AIå¯¹è¯</span>
                        <span class="expand-icon">â–¼</span>
                    </div>
                    <div class="section-content" id="aiSection">
                        <div class="nav-item" data-page="ai-chat">
                            <span class="nav-icon">ğŸ’¬</span>
                            <span>æ™ºèƒ½å¯¹è¯</span>
                        </div>
                        <div class="nav-item" data-page="ai-analysis">
                            <span class="nav-icon">ğŸ¤–</span>
                            <span>æ™ºèƒ½åˆ†æ</span>
                        </div>
                    </div>
                </div>

                <!-- æ•°æ®ç®¡ç† -->
                <div class="workspace-section">
                    <div class="section-header active" data-section="data">
                        <span>æ•°æ®ï¼ˆçŸ¥è¯†åº“ï¼‰æ£€ç´¢</span>
                        <span class="expand-icon">â–¼</span>
                    </div>
                    <div class="section-content" id="dataSection">
                        <div class="nav-item active" data-page="dashboard">
                            <span class="nav-icon">ğŸ“Š</span>
                            <span>ä»ªè¡¨æ¿</span>
                        </div>
                        <div class="nav-item" data-page="resumes">
                            <span class="nav-icon">ğŸ“‹</span>
                            <span>ç®€å†ç®¡ç†</span>
                        </div>
                        <div class="nav-item" data-page="analytics">
                            <span class="nav-icon">ğŸ“ˆ</span>
                            <span>æ•°æ®åˆ†æ</span>
                        </div>
                        <div class="nav-item" data-page="knowledge">
                            <span class="nav-icon">ğŸ“š</span>
                            <span>çŸ¥è¯†åº“</span>
                        </div>
                    </div>
                </div>

                <!-- æ•°æ®ä¸Šä¼  -->
                <div class="workspace-section">
                    <div class="section-header" data-section="upload">
                        <span>æ•°æ®ä¸Šä¼ </span>
                        <span class="expand-icon">â–¼</span>
                    </div>
                    <div class="section-content" id="uploadSection">
                        <div class="nav-item" data-page="upload-resume">
                            <span class="nav-icon">ğŸ“„</span>
                            <span>ä¸ªäººç®€å†ä¸Šä¼ </span>
                        </div>
                        <div class="nav-item" data-page="upload-company">
                            <span class="nav-icon">ğŸ¢</span>
                            <span>å…¬å¸ä»‹ç»ä¸Šä¼ </span>
                        </div>
                        <div class="nav-item" data-page="upload-job">
                            <span class="nav-icon">ğŸ’¼</span>
                            <span>å·¥ä½œæ¡ä»¶ä¸Šä¼ </span>
                        </div>
                        <div class="nav-item" data-page="upload-knowledge">
                            <span class="nav-icon">ğŸ“</span>
                            <span>çŸ¥è¯†çºªè¦ä¸Šä¼ </span>
                        </div>
                    </div>
                </div>

                <!-- ç³»ç»Ÿè®¾ç½® -->
                <div class="workspace-section">
                    <div class="section-header" data-section="settings">
                        <span>ç³»ç»Ÿè®¾ç½®</span>
                        <span class="expand-icon">â–¼</span>
                    </div>
                    <div class="section-content" id="settingsSection">
                        <div class="nav-item" data-page="settings">
                            <span class="nav-icon">âš™ï¸</span>
                            <span>ç³»ç»Ÿé…ç½®</span>
                        </div>
                        <div class="nav-item" data-page="user-settings">
                            <span class="nav-icon">ğŸ‘¤</span>
                            <span>ç”¨æˆ·è®¾ç½®</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ä¸»å†…å®¹åŒºåŸŸ -->
        <div class="main-content">
            <!-- é¡¶éƒ¨å¯¼èˆªæ  -->
            <div class="top-bar">
                <div class="breadcrumb">
                    <span class="breadcrumb-item">é¦–é¡µ</span>
                    <span>â€º</span>
                    <span class="breadcrumb-item active" id="currentPage">ä»ªè¡¨æ¿</span>
                </div>
                <div class="user-actions">
                    <button class="action-btn secondary" onclick="testConnection()">æµ‹è¯•è¿æ¥</button>
                    <button class="action-btn" onclick="refreshData()">åˆ·æ–°æ•°æ®</button>
                </div>
            </div>

            <!-- é¡µé¢å†…å®¹ -->
            <div class="page-content">
                <!-- ä»ªè¡¨æ¿é¡µé¢ -->
                <div class="content-area active" id="dashboard">
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-icon">ğŸ“‹</div>
                            <div class="stat-number" id="totalResumes">0</div>
                            <div class="stat-label">æ€»ç®€å†æ•°</div>
                            <div class="stat-trend">+5% æœ¬å‘¨</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">ğŸ†•</div>
                            <div class="stat-number" id="newResumes">0</div>
                            <div class="stat-label">ä»Šæ—¥æ–°å¢</div>
                            <div class="stat-trend">+12% è¾ƒæ˜¨æ—¥</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">ğŸ¯</div>
                            <div class="stat-number" id="avgSkills">0</div>
                            <div class="stat-label">å¹³å‡æŠ€èƒ½æ•°</div>
                            <div class="stat-trend">+8% æœ¬æœˆ</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">â­</div>
                            <div class="stat-number">96%</div>
                            <div class="stat-label">è§£ææˆåŠŸç‡</div>
                            <div class="stat-trend">+2% æœ¬æœˆ</div>
                        </div>
                    </div>

                    <div class="controls-panel">
                        <div class="controls-row">
                            <div class="search-box">
                                <input type="text" class="search-input" id="searchInput" placeholder="æœç´¢ç®€å†...">
                                <span class="search-icon">ğŸ”</span>
                            </div>
                            <div class="filter-group">
                                <select class="filter-select" id="skillFilter">
                                    <option value="">æ‰€æœ‰æŠ€èƒ½</option>
                                </select>
                                <select class="filter-select" id="eduFilter">
                                    <option value="">æ‰€æœ‰å­¦å†</option>
                                </select>
                                <button class="action-btn" onclick="exportData()">å¯¼å‡ºæ•°æ®</button>
                            </div>
                        </div>
                    </div>

                    <div class="resume-grid" id="resumeGrid">
                        <div class="loading">
                            <div class="spinner"></div>
                            æ­£åœ¨åŠ è½½ç®€å†æ•°æ®...
                        </div>
                    </div>
                </div>

                <!-- ç®€å†ç®¡ç†é¡µé¢ -->
                <div class="content-area" id="resumes">
                    <h2 style="margin-bottom: 20px;">ç®€å†ç®¡ç†</h2>
                    <div class="resume-grid" id="resumeManagementGrid">
                        <!-- ç®€å†ç®¡ç†å†…å®¹ -->
                    </div>
                </div>

                <!-- é¡¹ç›®æ–‡ä»¶ä¸Šä¼ é¡µé¢ -->
                <div class="content-area" id="project-upload">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <div>
                            <h2 id="projectUploadTitle">é¡¹ç›®æ–‡ä»¶ä¸Šä¼ </h2>
                            <span class="page-type-indicator project">é¡¹ç›®å­˜å‚¨</span>
                        </div>
                        <button class="action-btn secondary" onclick="loadProjectFiles()">æŸ¥çœ‹å·²ä¸Šä¼ æ–‡ä»¶</button>
                    </div>
                    <div class="upload-area" id="uploadArea-project">
                        <div class="upload-icon">ğŸ“</div>
                        <div class="upload-text">æ‹–æ”¾æ–‡ä»¶åˆ°æ­¤å¤„ï¼Œæˆ–ç‚¹å‡»ä¸Šä¼ </div>
                        <div class="upload-hint">æ”¯æŒ PDFã€DOCã€DOCXã€TXTã€å›¾ç‰‡ç­‰æ ¼å¼ | æ”¯æŒå¤šæ–‡ä»¶é€‰æ‹©å’Œæ–‡ä»¶å¤¹ä¸Šä¼ </div>
                        <input type="file" id="fileInput-project" style="display: none;" accept=".pdf,.doc,.docx,.txt,.png,.jpg,.jpeg,.gif,.xls,.xlsx,.ppt,.pptx,.md" multiple>
                        <div style="margin-top: 15px;">
                            <button class="action-btn secondary" onclick="selectFiles('project')">é€‰æ‹©æ–‡ä»¶</button>
                            <button class="action-btn secondary" onclick="selectFolder('project')" style="margin-left: 10px;">é€‰æ‹©æ–‡ä»¶å¤¹</button>
                        </div>
                    </div>
                    <div id="uploadProgress-project" style="display: none;">
                        <div class="loading">
                            <div class="spinner"></div>
                            æ­£åœ¨ä¸Šä¼ æ–‡ä»¶...
                        </div>
                    </div>
                </div>

                <!-- ä¸Šä¼ ç®€å†é¡µé¢ -->
                <div class="content-area" id="upload-resume">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <div>
                            <h2>ä¸ªäººç®€å†ä¸Šä¼ </h2>
                            <span class="page-type-indicator category">åˆ†ç±»å­˜å‚¨</span>
                        </div>
                        <button class="action-btn secondary" onclick="loadCategoryFiles('resume')">æŸ¥çœ‹å·²ä¸Šä¼ æ–‡ä»¶</button>
                    </div>
                    <div class="upload-area" id="uploadArea-resume">
                        <div class="upload-icon">ğŸ“„</div>
                        <div class="upload-text">æ‹–æ”¾ç®€å†æ–‡ä»¶åˆ°æ­¤å¤„ï¼Œæˆ–ç‚¹å‡»ä¸Šä¼ </div>
                        <div class="upload-hint">æ”¯æŒ PDFã€DOCã€DOCX æ ¼å¼ | æ”¯æŒå¤šæ–‡ä»¶é€‰æ‹©å’Œæ–‡ä»¶å¤¹ä¸Šä¼ </div>
                        <input type="file" id="fileInput-resume" style="display: none;" accept=".pdf,.doc,.docx" multiple>
                        <div style="margin-top: 15px;">
                            <button class="action-btn secondary" onclick="selectFiles('resume')">é€‰æ‹©æ–‡ä»¶</button>
                            <button class="action-btn secondary" onclick="selectFolder('resume')" style="margin-left: 10px;">é€‰æ‹©æ–‡ä»¶å¤¹</button>
                        </div>
                    </div>
                    <div id="uploadProgress-resume" style="display: none;">
                        <div class="loading">
                            <div class="spinner"></div>
                            æ­£åœ¨ä¸Šä¼ å¹¶è§£æç®€å†...
                        </div>
                    </div>
                </div>

                <!-- å…¬å¸ä»‹ç»ä¸Šä¼ é¡µé¢ -->
                <div class="content-area" id="upload-company">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <div>
                            <h2>å…¬å¸ä»‹ç»ä¸Šä¼ </h2>
                            <span class="page-type-indicator category">åˆ†ç±»å­˜å‚¨</span>
                        </div>
                        <button class="action-btn secondary" onclick="loadCategoryFiles('company')">æŸ¥çœ‹å·²ä¸Šä¼ æ–‡ä»¶</button>
                    </div>
                    <div class="upload-area" id="uploadArea-company">
                        <div class="upload-icon">ğŸ¢</div>
                        <div class="upload-text">ä¸Šä¼ å…¬å¸ä»‹ç»æ–‡ä»¶</div>
                        <div class="upload-hint">æ”¯æŒ PDFã€DOCã€DOCXã€TXT æ ¼å¼ | æ”¯æŒå¤šæ–‡ä»¶é€‰æ‹©å’Œæ–‡ä»¶å¤¹ä¸Šä¼ </div>
                        <input type="file" id="fileInput-company" style="display: none;" accept=".pdf,.doc,.docx,.txt" multiple>
                        <div style="margin-top: 15px;">
                            <button class="action-btn secondary" onclick="selectFiles('company')">é€‰æ‹©æ–‡ä»¶</button>
                            <button class="action-btn secondary" onclick="selectFolder('company')" style="margin-left: 10px;">é€‰æ‹©æ–‡ä»¶å¤¹</button>
                        </div>
                    </div>
                    <div id="uploadProgress-company" style="display: none;">
                        <div class="loading">
                            <div class="spinner"></div>
                            æ­£åœ¨ä¸Šä¼ æ–‡ä»¶...
                        </div>
                    </div>
                </div>

                <!-- å·¥ä½œæ¡ä»¶ä¸Šä¼ é¡µé¢ -->
                <div class="content-area" id="upload-job">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <div>
                            <h2>å·¥ä½œæ¡ä»¶ä¸Šä¼ </h2>
                            <span class="page-type-indicator category">åˆ†ç±»å­˜å‚¨</span>
                        </div>
                        <button class="action-btn secondary" onclick="loadCategoryFiles('job')">æŸ¥çœ‹å·²ä¸Šä¼ æ–‡ä»¶</button>
                    </div>
                    <div class="upload-area" id="uploadArea-job">
                        <div class="upload-icon">ğŸ’¼</div>
                        <div class="upload-text">ä¸Šä¼ å·¥ä½œæ¡ä»¶è¯´æ˜</div>
                        <div class="upload-hint">æ”¯æŒ PDFã€DOCã€DOCXã€TXT æ ¼å¼ | æ”¯æŒå¤šæ–‡ä»¶é€‰æ‹©å’Œæ–‡ä»¶å¤¹ä¸Šä¼ </div>
                        <input type="file" id="fileInput-job" style="display: none;" accept=".pdf,.doc,.docx,.txt" multiple>
                        <div style="margin-top: 15px;">
                            <button class="action-btn secondary" onclick="selectFiles('job')">é€‰æ‹©æ–‡ä»¶</button>
                            <button class="action-btn secondary" onclick="selectFolder('job')" style="margin-left: 10px;">é€‰æ‹©æ–‡ä»¶å¤¹</button>
                        </div>
                    </div>
                    <div id="uploadProgress-job" style="display: none;">
                        <div class="loading">
                            <div class="spinner"></div>
                            æ­£åœ¨ä¸Šä¼ æ–‡ä»¶...
                        </div>
                    </div>
                </div>

                <!-- çŸ¥è¯†çºªè¦ä¸Šä¼ é¡µé¢ -->
                <div class="content-area" id="upload-knowledge">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <div>
                            <h2>çŸ¥è¯†çºªè¦ä¸Šä¼ </h2>
                            <span class="page-type-indicator category">åˆ†ç±»å­˜å‚¨</span>
                        </div>
                        <button class="action-btn secondary" onclick="loadCategoryFiles('knowledge')">æŸ¥çœ‹å·²ä¸Šä¼ æ–‡ä»¶</button>
                    </div>
                    <div class="upload-area" id="uploadArea-knowledge">
                        <div class="upload-icon">ğŸ“</div>
                        <div class="upload-text">ä¸Šä¼ çŸ¥è¯†åº“æ–‡æ¡£</div>
                        <div class="upload-hint">æ”¯æŒ PDFã€DOCã€DOCXã€TXTã€MD æ ¼å¼ | æ”¯æŒå¤šæ–‡ä»¶é€‰æ‹©å’Œæ–‡ä»¶å¤¹ä¸Šä¼ </div>
                        <input type="file" id="fileInput-knowledge" style="display: none;" accept=".pdf,.doc,.docx,.txt,.md" multiple>
                        <div style="margin-top: 15px;">
                            <button class="action-btn secondary" onclick="selectFiles('knowledge')">é€‰æ‹©æ–‡ä»¶</button>
                            <button class="action-btn secondary" onclick="selectFolder('knowledge')" style="margin-left: 10px;">é€‰æ‹©æ–‡ä»¶å¤¹</button>
                        </div>
                    </div>
                    <div id="uploadProgress-knowledge" style="display: none;">
                        <div class="loading">
                            <div class="spinner"></div>
                            æ­£åœ¨ä¸Šä¼ æ–‡ä»¶...
                        </div>
                    </div>
                </div>

                <!-- APIæµ‹è¯•é¡µé¢ -->
                <div class="content-area" id="api-test">
                    <h2 style="margin-bottom: 20px;">APIæ¥å£æµ‹è¯•</h2>
                    <div class="stat-card">
                        <h3 style="margin-bottom: 15px;">æ¥å£æµ‹è¯•å·¥å…·</h3>
                        <div class="info-row">
                            <span class="info-label">å½“å‰API:</span>
                            <span class="info-value" id="currentApiUrl">http://localhost:5000/api</span>
                        </div>
                        <div style="margin-top: 20px;">
                            <button class="action-btn" onclick="testAllEndpoints()">æµ‹è¯•æ‰€æœ‰æ¥å£</button>
                            <button class="action-btn secondary" onclick="getSystemInfo()" style="margin-left: 10px;">è·å–ç³»ç»Ÿä¿¡æ¯</button>
                        </div>
                    </div>
                </div>

                <!-- AIå¯¹è¯é¡µé¢ -->
                <div class="content-area" id="ai-chat">
                    <h2 style="margin-bottom: 20px;">AIæ™ºèƒ½å¯¹è¯</h2>
                    <div class="stat-card">
                        <h3 style="margin-bottom: 15px;">æ™ºèƒ½åŠ©æ‰‹</h3>
                        <p>AIå¯¹è¯åŠŸèƒ½å¼€å‘ä¸­...</p>
                    </div>
                </div>

                <!-- æ•°æ®åˆ†æé¡µé¢ -->
                <div class="content-area" id="analytics">
                    <h2 style="margin-bottom: 20px;">æ•°æ®åˆ†æ</h2>
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-icon">ğŸ«</div>
                            <div class="stat-number">985</div>
                            <div class="stat-label">985é™¢æ ¡æ¯”ä¾‹</div>
                            <div class="stat-trend">35%</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">ğŸ’¼</div>
                            <div class="stat-number">3.2å¹´</div>
                            <div class="stat-label">å¹³å‡å·¥ä½œç»éªŒ</div>
                            <div class="stat-trend">ç»éªŒåˆ†å¸ƒå‡åŒ€</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">ğŸ”§</div>
                            <div class="stat-number">Java</div>
                            <div class="stat-label">çƒ­é—¨æŠ€èƒ½</div>
                            <div class="stat-trend">45% æŒæ¡ç‡</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">ğŸŒ</div>
                            <div class="stat-number">åŒ—äº¬</div>
                            <div class="stat-label">ä¸»è¦åŸå¸‚</div>
                            <div class="stat-trend">28% åˆ†å¸ƒ</div>
                        </div>
                    </div>
                </div>

                <!-- çŸ¥è¯†åº“é¡µé¢ -->
                <div class="content-area" id="knowledge">
                    <h2 style="margin-bottom: 20px;">çŸ¥è¯†åº“ç®¡ç†</h2>
                    <div class="stat-card">
                        <h3 style="margin-bottom: 15px;">çŸ¥è¯†åº“ç»Ÿè®¡</h3>
                        <div class="info-row">
                            <span class="info-label">æ–‡æ¡£æ€»æ•°:</span>
                            <span class="info-value">156</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">ä»Šæ—¥æ–°å¢:</span>
                            <span class="info-value">8</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">æ£€ç´¢æ¬¡æ•°:</span>
                            <span class="info-value">1,245</span>
                        </div>
                    </div>
                </div>

                <!-- ç³»ç»Ÿè®¾ç½®é¡µé¢ -->
                <div class="content-area" id="settings">
                    <h2 style="margin-bottom: 20px;">ç³»ç»Ÿè®¾ç½®</h2>
                    <div class="stat-card">
                        <h3 style="margin-bottom: 15px;">APIé…ç½®</h3>
                        <div class="info-row">
                            <span class="info-label">APIåœ°å€:</span>
                            <span class="info-value" id="apiUrl">http://localhost:5000/api</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">æ•°æ®åº“:</span>
                            <span class="info-value">MongoDB (ai_resume)</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">æ–‡ä»¶å­˜å‚¨:</span>
                            <span class="info-value">æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿ</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">çŠ¶æ€:</span>
                            <span class="info-value" id="connectionStatus">æ£€æŸ¥ä¸­...</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- é¡¹ç›®ç®¡ç†æ¨¡æ€æ¡† -->
    <div class="modal" id="projectManagerModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>é¡¹ç›®ç®¡ç†</h3>
                <button class="close-btn" onclick="closeProjectManager()">Ã—</button>
            </div>
            <div class="modal-body">
                <div style="margin-bottom: 20px;">
                    <h4 style="margin-bottom: 10px;">åˆ›å»ºæ–°é¡¹ç›®</h4>
                    <div style="display: flex; gap: 10px;">
                        <input type="text" id="newProjectNameInput" placeholder="é¡¹ç›®åç§°" style="flex: 1; padding: 8px 12px; border: 1px solid #dadce0; border-radius: 6px;">
                        <input type="text" id="newProjectDescInput" placeholder="é¡¹ç›®æè¿°ï¼ˆå¯é€‰ï¼‰" style="flex: 2; padding: 8px 12px; border: 1px solid #dadce0; border-radius: 6px;">
                        <button class="action-btn" onclick="createProjectFromModal()">åˆ›å»º</button>
                    </div>
                </div>

                <div>
                    <h4 style="margin-bottom: 10px;">ç°æœ‰é¡¹ç›®</h4>
                    <div id="projectManagerList">
                        <!-- é¡¹ç›®åˆ—è¡¨å°†åœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- è¯¦æƒ…æ¨¡æ€æ¡† -->
    <div class="modal" id="detailModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modalTitle">è¯¦æƒ…</h3>
                <button class="close-btn" onclick="closeModal()">Ã—</button>
            </div>
            <div class="modal-body" id="modalBody">
                <!-- è¯¦æƒ…å†…å®¹ -->
            </div>
        </div>
    </div>

    <!-- çŠ¶æ€æ¶ˆæ¯ -->
    <div class="status-message" id="statusMessage"></div>

    <script>
        // å…¨å±€å˜é‡
        const API_BASE_URL = 'http://localhost:5000/api';
        let allResumes = [];
        let filteredResumes = [];
        let currentPage = 'dashboard';
        let currentProject = null;
        let allProjects = [];
        let currentCategoryFiles = {}; // å­˜å‚¨å„ç±»åˆ«çš„æ–‡ä»¶åˆ—è¡¨
        let currentProjectFiles = []; // å­˜å‚¨å½“å‰é¡¹ç›®çš„æ–‡ä»¶åˆ—è¡¨

        // å­—æ®µåˆ†ç»„å®šä¹‰ - ä½¿ç”¨åç«¯è¿”å›çš„è‡ªå®šä¹‰ç»“æ„
        let FIELD_GROUPS = {};
        let FIELD_STRUCTURE = {};
        let FIELD_GROUPS_DISPLAY = {};

        // åˆ†ç»„åç§°æ˜ å°„ï¼ˆç”¨äºæ˜¾ç¤ºä¸­æ–‡åç§°ï¼‰
        let GROUP_NAME_MAP = {};

        // åˆå§‹åŒ–å­—æ®µç»“æ„
        async function initializeFieldStructure() {
            try {
                // è·å–å­—æ®µç»“æ„å®šä¹‰
                const structureResponse = await fetch(`${API_BASE_URL}/fields/structure`);
                if (structureResponse.ok) {
                    FIELD_STRUCTURE = await structureResponse.json();
                    
                    // æ„å»ºå­—æ®µåˆ†ç»„
                    for (const [groupKey, fields] of Object.entries(FIELD_STRUCTURE)) {
                        FIELD_GROUPS[groupKey] = Object.keys(fields);
                    }
                }

                // è·å–å­—æ®µåˆ†ç»„æ˜¾ç¤ºé…ç½®
                const groupsResponse = await fetch(`${API_BASE_URL}/fields/groups`);
                if (groupsResponse.ok) {
                    FIELD_GROUPS_DISPLAY = await groupsResponse.json();
                    
                    // æ„å»ºåˆ†ç»„åç§°æ˜ å°„
                    for (const [groupKey, config] of Object.entries(FIELD_GROUPS_DISPLAY)) {
                        GROUP_NAME_MAP[groupKey] = config.name;
                    }
                }

                console.log('å­—æ®µç»“æ„åˆå§‹åŒ–å®Œæˆ:', {
                    FIELD_STRUCTURE,
                    FIELD_GROUPS,
                    FIELD_GROUPS_DISPLAY,
                    GROUP_NAME_MAP
                });
            } catch (error) {
                console.error('å­—æ®µç»“æ„åˆå§‹åŒ–å¤±è´¥:', error);
                // ä½¿ç”¨é»˜è®¤ç»“æ„ä½œä¸ºåå¤‡
                initializeDefaultFieldStructure();
            }
        }

        // é»˜è®¤å­—æ®µç»“æ„ï¼ˆä½œä¸ºåå¤‡ï¼‰- åŸºäºResumeSDKå®˜æ–¹æ–‡æ¡£
        function initializeDefaultFieldStructure() {
            FIELD_GROUPS = {
                'basic_info': ['name', 'gender', 'age', 'birthday', 'mobile', 'email', 'living_address', 'hometown_address', 'hukou_address', 'city', 'race', 'surname', 'workExpYear', 'github', 'zhihu', 'wechat', 'qq', 'linkedin', 'blog', 'website', 'avatar', 'expect_job', 'expect_salary', 'expect_city', 'expect_industry', 'resume_name', 'resume_update_time', 'resume_text'],
                'education': ['college', 'major', 'education', 'degree', 'college_type', 'college_rank', 'grad_time', 'education_start_time', 'education_end_time', 'gpa', 'course', 'education_desc'],
                'work_experience': ['company_name', 'department_name', 'job_position', 'work_time', 'work_start_time', 'work_end_time', 'work_desc', 'salary', 'work_type', 'industry', 'company_size', 'company_nature', 'report_to', 'subordinates', 'achievement'],
                'project_experience': ['project_name', 'project_role', 'project_time', 'project_start_time', 'project_end_time', 'project_desc', 'project_content', 'project_technology', 'project_result', 'project_scale', 'project_budget', 'project_team_size'],
                'skills': ['skill_name', 'skill_level', 'skill_desc', 'skill_years', 'skill_category'],
                'language_skills': ['language_name', 'language_level', 'language_certificate', 'language_score'],
                'certificates': ['award_info', 'award_time', 'award_desc', 'award_level', 'award_issuer', 'certificate_type'],
                'training': ['training_name', 'training_time', 'training_desc', 'training_institution', 'training_certificate', 'training_duration'],
                'social_practice': ['practice_name', 'practice_time', 'practice_desc', 'practice_role', 'practice_organization'],
                'self_evaluation': ['aboutme_desc', 'self_introduction', 'hobby', 'strength', 'weakness', 'career_goal']
            };

            GROUP_NAME_MAP = {
                'basic_info': 'åŸºæœ¬ä¿¡æ¯',
                'education': 'æ•™è‚²ç»å†',
                'work_experience': 'å·¥ä½œç»å†',
                'project_experience': 'é¡¹ç›®ç»å†',
                'skills': 'æŠ€èƒ½åˆ—è¡¨',
                'language_skills': 'è¯­è¨€æŠ€èƒ½',
                'certificates': 'è¯ä¹¦å¥–é¡¹',
                'training': 'åŸ¹è®­ç»å†',
                'social_practice': 'ç¤¾ä¼šå®è·µ',
                'self_evaluation': 'ä¸ªäººè¯„ä»·'
            };
        }

        // æ–‡ä»¶ç±»åˆ«æ˜ å°„
        const FILE_CATEGORIES = {
            'resume': 'ä¸ªäººç®€å†',
            'company': 'å…¬å¸ä»‹ç»',
            'job': 'å·¥ä½œæ¡ä»¶',
            'knowledge': 'çŸ¥è¯†çºªè¦'
        };

        // åˆ›å»ºæ—¥å¿—å¯¹è±¡
        const logger = {
            info: (message) => {
                console.log(`[INFO] ${message}`);
            },
            error: (message) => {
                console.error(`[ERROR] ${message}`);
            },
            warn: (message) => {
                console.warn(`[WARN] ${message}`);
            }
        };

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
        });

        async function initializeApp() {
            // é¦–å…ˆåˆå§‹åŒ–å­—æ®µç»“æ„
            await initializeFieldStructure();
            
            setupEventListeners();
            await loadProjects();
            await loadData();
            updateStats();
        }

        function setupEventListeners() {
            // ä¾§è¾¹æ å¯¼èˆªç‚¹å‡»
            document.querySelectorAll('.nav-item').forEach(item => {
                item.addEventListener('click', function() {
                    const page = this.dataset.page;
                    if (page) {
                        switchPage(page);
                    }
                });
            });

            // åˆ†åŒºæŠ˜å /å±•å¼€
            document.querySelectorAll('.section-header').forEach(header => {
                header.addEventListener('click', function() {
                    toggleSection(this.dataset.section);
                });
            });

            // æœç´¢
            document.getElementById('searchInput').addEventListener('input', handleSearch);

            // ä¸ºæ¯ä¸ªç±»åˆ«è®¾ç½®ä¸Šä¼ äº‹ä»¶
            Object.keys(FILE_CATEGORIES).forEach(category => {
                setupCategoryUpload(category);
            });

            // ä¸ºé¡¹ç›®ä¸Šä¼ è®¾ç½®äº‹ä»¶
            setupProjectUpload();

            // æ¨¡æ€æ¡†ç‚¹å‡»å¤–éƒ¨å…³é—­
            document.getElementById('detailModal').addEventListener('click', function(e) {
                if (e.target === this) closeModal();
            });

            document.getElementById('projectManagerModal').addEventListener('click', function(e) {
                if (e.target === this) closeProjectManager();
            });
        }

        function setupCategoryUpload(category) {
            const uploadArea = document.getElementById(`uploadArea-${category}`);
            const fileInput = document.getElementById(`fileInput-${category}`);

            if (!uploadArea || !fileInput) return;

            uploadArea.addEventListener('click', (e) => {
                if (e.target.tagName === 'BUTTON') return;
                fileInput.click();
            });

            uploadArea.addEventListener('dragover', handleDragOver);
            uploadArea.addEventListener('dragleave', handleDragLeave);
            uploadArea.addEventListener('drop', (e) => handleDrop(e, category));

            fileInput.addEventListener('change', (e) => handleFileSelect(e, category));
        }

        function setupProjectUpload() {
            const uploadArea = document.getElementById('uploadArea-project');
            const fileInput = document.getElementById('fileInput-project');

            if (!uploadArea || !fileInput) return;

            uploadArea.addEventListener('click', (e) => {
                if (e.target.tagName === 'BUTTON') return;
                fileInput.click();
            });

            uploadArea.addEventListener('dragover', handleDragOver);
            uploadArea.addEventListener('dragleave', handleDragLeave);
            uploadArea.addEventListener('drop', (e) => handleDrop(e, 'project'));

            fileInput.addEventListener('change', (e) => handleFileSelect(e, 'project'));
        }

        function selectFiles(category) {
            const fileInput = document.getElementById(`fileInput-${category}`);
            if (fileInput) {
                fileInput.removeAttribute('webkitdirectory');
                fileInput.click();
            }
        }

        function selectFolder(category) {
            const fileInput = document.getElementById(`fileInput-${category}`);
            if (fileInput) {
                fileInput.setAttribute('webkitdirectory', '');
                fileInput.click();
            }
        }

        function switchProject(projectId) {
            document.querySelectorAll('.project-item').forEach(item => {
                item.classList.remove('active');
            });

            const projectElement = document.querySelector(`[data-project="${projectId}"]`);
            if (projectElement) {
                projectElement.classList.add('active');
            }

            currentProject = projectId;
            const project = allProjects.find(p => p._id === projectId);
            const projectName = project ? project.name : 'æœªçŸ¥é¡¹ç›®';

            // åˆ‡æ¢åˆ°é¡¹ç›®æ–‡ä»¶ä¸Šä¼ é¡µé¢
            switchPage('project-upload');

            // æ›´æ–°é¡¹ç›®ä¸Šä¼ é¡µé¢çš„æ ‡é¢˜
            const titleElement = document.getElementById('projectUploadTitle');
            if (titleElement) {
                titleElement.textContent = `${projectName} - æ–‡ä»¶ä¸Šä¼ `;
            }

            showMessage(`å·²åˆ‡æ¢åˆ°é¡¹ç›®: ${projectName}`, 'info');

            // åŠ è½½é¡¹ç›®æ–‡ä»¶åˆ—è¡¨
            loadProjectFiles();
        }

        function toggleSection(sectionId) {
            const header = document.querySelector(`[data-section="${sectionId}"]`);
            const content = document.getElementById(sectionId + 'Section');

            header.classList.toggle('collapsed');
            content.classList.toggle('collapsed');
        }

        function switchPage(page) {
            // æ›´æ–°å¯¼èˆªçŠ¶æ€
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });

            const navItem = document.querySelector(`[data-page="${page}"]`);
            if (navItem) {
                navItem.classList.add('active');
            }

            // æ›´æ–°é¢åŒ…å±‘
            const pageNames = {
                'dashboard': 'ä»ªè¡¨æ¿',
                'resumes': 'ç®€å†ç®¡ç†',
                'project-upload': 'é¡¹ç›®æ–‡ä»¶ä¸Šä¼ ',
                'upload-resume': 'ä¸ªäººç®€å†ä¸Šä¼ ',
                'upload-company': 'å…¬å¸ä»‹ç»ä¸Šä¼ ',
                'upload-job': 'å·¥ä½œæ¡ä»¶ä¸Šä¼ ',
                'upload-knowledge': 'çŸ¥è¯†çºªè¦ä¸Šä¼ ',
                'api-test': 'APIæµ‹è¯•',
                'ai-chat': 'AIå¯¹è¯',
                'analytics': 'æ•°æ®åˆ†æ',
                'knowledge': 'çŸ¥è¯†åº“',
                'settings': 'ç³»ç»Ÿè®¾ç½®'
            };
            document.getElementById('currentPage').textContent = pageNames[page] || page;

            // åˆ‡æ¢é¡µé¢å†…å®¹
            document.querySelectorAll('.content-area').forEach(area => {
                area.classList.remove('active');
            });
            document.getElementById(page).classList.add('active');

            currentPage = page;

            // åŠ è½½é¡µé¢ç‰¹å®šå†…å®¹
            if (page === 'resumes') {
                loadResumeManagement();
            } else if (page === 'settings') {
                checkConnectionStatus();
            } else if (page.startsWith('upload-')) {
                const category = page.replace('upload-', '');
                if (FILE_CATEGORIES[category]) {
                    loadCategoryFiles(category);
                }
            } else if (page === 'project-upload') {
                loadProjectFiles();
            }
        }

        function showNewProjectInput() {
            const inputDiv = document.getElementById('newProjectInput');
            inputDiv.style.display = 'block';
            inputDiv.querySelector('input').focus();
        }

        function handleNewProject(event) {
            if (event.key === 'Enter') {
                const input = event.target;
                const projectName = input.value.trim();

                if (projectName) {
                    createProject(projectName).then(success => {
                        if (success) {
                            input.value = '';
                            document.getElementById('newProjectInput').style.display = 'none';
                        }
                    });
                }
            } else if (event.key === 'Escape') {
                event.target.value = '';
                document.getElementById('newProjectInput').style.display = 'none';
            }
        }

        async function loadProjects() {
            try {
                const response = await fetch(`${API_BASE_URL}/projects`);

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }

                allProjects = await response.json();
                renderProjectList();

                if (!currentProject && allProjects.length > 0) {
                    currentProject = allProjects[0]._id;
                }

                logger.info(`æˆåŠŸåŠ è½½ ${allProjects.length} ä¸ªé¡¹ç›®`);

            } catch (error) {
                console.error('åŠ è½½é¡¹ç›®å¤±è´¥:', error);
                showMessage('åŠ è½½é¡¹ç›®å¤±è´¥: ' + error.message, 'error');
            }
        }

        function renderProjectList() {
            const projectsSection = document.getElementById('projectsSection');
            if (!projectsSection) return;

            const addProjectElement = projectsSection.querySelector('.add-project');
            const newProjectInputElement = projectsSection.querySelector('.new-project-input');

            const projectItems = projectsSection.querySelectorAll('.project-item');
            projectItems.forEach(item => item.remove());

            allProjects.forEach((project, index) => {
                const projectElement = document.createElement('div');
                projectElement.className = `project-item ${index === 0 && !currentProject ? 'active' : ''}`;
                projectElement.setAttribute('data-project', project._id);
                projectElement.innerHTML = `
                    <div class="project-dot"></div>
                    <span id="sidebarProjectNameDisplay-${project._id}" title="${project.description || project.name}">${project.name}</span>
                    <input id="sidebarProjectNameInput-${project._id}" type="text" value="${project.name}" style="display:none; padding:2px 6px; font-size:14px; border:1px solid #dadce0; border-radius:4px; min-width:60px; margin-left:4px;" onkeydown="handleSidebarProjectNameEdit(event, '${project._id}')" />
                    <button class="btn-small" style="margin-left:4px;" onclick="showSidebarProjectNameEdit('${project._id}');event.stopPropagation();">ç¼–è¾‘</button>
                `;
                projectElement.addEventListener('click', function() {
                    switchProject(project._id);
                });
                projectsSection.insertBefore(projectElement, addProjectElement);
            });

            if (!currentProject && allProjects.length > 0) {
                currentProject = allProjects[0]._id;
                document.querySelector(`[data-project="${currentProject}"]`)?.classList.add('active');
            }
        }

        async function createProject(name, description = '') {
            try {
                const response = await fetch(`${API_BASE_URL}/projects`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ name, description })
                });

                const result = await response.json();

                if (response.ok) {
                    showMessage(`é¡¹ç›® "${name}" åˆ›å»ºæˆåŠŸ`, 'success');
                    await loadProjects();

                    if (result.project) {
                        switchProject(result.project._id);
                    }

                    return true;
                } else {
                    showMessage(result.error || 'åˆ›å»ºé¡¹ç›®å¤±è´¥', 'error');
                    return false;
                }

            } catch (error) {
                console.error('åˆ›å»ºé¡¹ç›®å¤±è´¥:', error);
                showMessage('åˆ›å»ºé¡¹ç›®å¤±è´¥: ' + error.message, 'error');
                return false;
            }
        }

        async function loadData() {
            try {
                showMessage('æ­£åœ¨åŠ è½½æ•°æ®...', 'info');
                const response = await fetch(`${API_BASE_URL}/resume/all`);

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }

                const data = await response.json();
                
                // è°ƒè¯•ä¿¡æ¯ï¼šæ£€æŸ¥APIè¿”å›çš„åŸå§‹æ•°æ®
                console.log('APIè¿”å›çš„åŸå§‹æ•°æ®:', data);
                if (data.length > 0) {
                    const firstResume = data[0];
                    console.log('ç¬¬ä¸€æ¡ç®€å†æ•°æ®:', firstResume);
                    console.log('skills_objs å­—æ®µ:', {
                        value: firstResume.skills_objs,
                        type: typeof firstResume.skills_objs,
                        isArray: Array.isArray(firstResume.skills_objs),
                        isObject: typeof firstResume.skills_objs === 'object' && firstResume.skills_objs !== null
                    });
                    console.log('job_exp_objs å­—æ®µ:', {
                        value: firstResume.job_exp_objs,
                        type: typeof firstResume.job_exp_objs,
                        isArray: Array.isArray(firstResume.job_exp_objs),
                        isObject: typeof firstResume.job_exp_objs === 'object' && firstResume.job_exp_objs !== null
                    });
                }
                
                allResumes = data;
                filteredResumes = [...allResumes];

                renderResumeGrid();
                updateFilters();
                showMessage('æ•°æ®åŠ è½½æˆåŠŸ', 'success');

            } catch (error) {
                console.error('åŠ è½½æ•°æ®å¤±è´¥:', error);
                showMessage('æ•°æ®åŠ è½½å¤±è´¥: ' + error.message, 'error');
                const gridElement = document.getElementById('resumeGrid');
                if (gridElement) {
                    gridElement.innerHTML = `
                        <div style="grid-column: 1 / -1; text-align: center; padding: 60px;">
                            <div style="font-size: 48px; margin-bottom: 20px;">âš ï¸</div>
                            <h3>æ•°æ®åŠ è½½å¤±è´¥</h3>
                            <p>è¯·æ£€æŸ¥APIè¿æ¥çŠ¶æ€</p>
                            <button class="action-btn" onclick="loadData()" style="margin-top: 20px;">é‡è¯•</button>
                        </div>
                    `;
                }
            }
        }

        function updateStats() {
            const totalCount = allResumes.length;
            const todayCount = Math.floor(Math.random() * 5);
            const avgSkills = totalCount > 0 ? Math.round(
                allResumes.reduce((sum, resume) =>
                    sum + (resume.skills_objs ? resume.skills_objs.length : 0), 0) / totalCount
            ) : 0;

            const totalElement = document.getElementById('totalResumes');
            const newElement = document.getElementById('newResumes');
            const avgElement = document.getElementById('avgSkills');

            if (totalElement) totalElement.textContent = totalCount;
            if (newElement) newElement.textContent = todayCount;
            if (avgElement) avgElement.textContent = avgSkills;
        }

        function renderResumeGrid() {
            const grid = document.getElementById('resumeGrid');
            if (!grid) return;

            if (filteredResumes.length === 0) {
                grid.innerHTML = `
                    <div style="grid-column: 1 / -1; text-align: center; padding: 60px;">
                        <div style="font-size: 48px; margin-bottom: 20px;">ğŸ“‹</div>
                        <h3>æš‚æ— ç®€å†æ•°æ®</h3>
                        <p>è¯·ä¸Šä¼ ç®€å†æˆ–æ£€æŸ¥æœç´¢æ¡ä»¶</p>
                    </div>
                `;
                return;
            }

            grid.innerHTML = filteredResumes.map(resume => {
                // å¥å£®æ€§å¤„ç†ï¼šskills_objs å¿…é¡»ä¸ºæ•°ç»„
                const skills = Array.isArray(resume.skills_objs) ? resume.skills_objs : [];
                return `
                <div class="resume-card">
                    <div class="card-header">
                        <div class="avatar">
                            ${resume.name ? resume.name.charAt(0) : 'U'}
                        </div>
                        <div class="card-info">
                            <h3>${resume.name || 'æœªçŸ¥å§“å'}</h3>
                            <p>${resume.major || 'ä¸“ä¸šå¾…æ›´æ–°'}</p>
                        </div>
                    </div>
                    <div class="card-content">
                        <div class="info-row">
                            <span class="info-label">é‚®ç®±:</span>
                            <span class="info-value">${resume.email || 'æœªæä¾›'}</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">ç”µè¯:</span>
                            <span class="info-value">${resume.phone || 'æœªæä¾›'}</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">å­¦æ ¡:</span>
                            <span class="info-value">${resume.college || 'æœªæä¾›'}</span>
                        </div>
                            ${skills.length > 0 ? `
                            <div class="skills-tags">
                                    ${skills.slice(0, 3).map(skill =>
                                    `<span class="skill-tag">${skill.skills_name}</span>`
                                ).join('')}
                                    ${skills.length > 3 ?
                                        `<span class="skill-tag">+${skills.length - 3}</span>` : ''}
                            </div>
                        ` : ''}
                    </div>
                    <div class="card-actions">
                        <button class="btn-small primary" onclick="viewDetails('${resume._id}')">æŸ¥çœ‹è¯¦æƒ…</button>
                        <button class="btn-small" onclick="editResume('${resume._id}')">ç¼–è¾‘</button>
                        <button class="btn-small danger" onclick="deleteResume('${resume._id}')">åˆ é™¤</button>
                    </div>
                </div>
                `;
            }).join('');
        }

        function updateFilters() {
            const skillFilter = document.getElementById('skillFilter');
            const eduFilter = document.getElementById('eduFilter');

            if (!skillFilter || !eduFilter) return;

            const allSkills = new Set();
            allResumes.forEach(resume => {
                const skills = Array.isArray(resume.skills_objs) ? resume.skills_objs : [];
                skills.forEach(skill => {
                        allSkills.add(skill.skills_name);
                    });
            });

            skillFilter.innerHTML = '<option value="">æ‰€æœ‰æŠ€èƒ½</option>' +
                Array.from(allSkills).map(skill =>
                    `<option value="${skill}">${skill}</option>`
                ).join('');

            const allEducation = new Set();
            allResumes.forEach(resume => {
                if (resume.college) {
                    allEducation.add(resume.college);
                }
            });

            eduFilter.innerHTML = '<option value="">æ‰€æœ‰å­¦æ ¡</option>' +
                Array.from(allEducation).slice(0, 20).map(edu =>
                    `<option value="${edu}">${edu}</option>`
                ).join('');
        }

        function handleSearch() {
            const searchInput = document.getElementById('searchInput');
            if (!searchInput) return;

            const searchTerm = searchInput.value.toLowerCase();

            if (!searchTerm) {
                filteredResumes = [...allResumes];
            } else {
                filteredResumes = allResumes.filter(resume => {
                    return (
                        (resume.name && resume.name.toLowerCase().includes(searchTerm)) ||
                        (resume.college && resume.college.toLowerCase().includes(searchTerm)) ||
                        (resume.email && resume.email.toLowerCase().includes(searchTerm)) ||
                        (resume.skills_objs && resume.skills_objs.some(skill =>
                            skill.skills_name && skill.skills_name.toLowerCase().includes(searchTerm)
                        ))
                    );
                });
            }

            renderResumeGrid();
        }

        // ============ é¡¹ç›®æ–‡ä»¶ç®¡ç† ============
        async function loadProjectFiles() {
            if (!currentProject) {
                showMessage('è¯·å…ˆé€‰æ‹©ä¸€ä¸ªé¡¹ç›®', 'error');
                return;
            }

            try {
                const response = await fetch(`${API_BASE_URL}/projects/${currentProject}/files`);

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }

                const files = await response.json();
                currentProjectFiles = files;

                // è°ƒè¯•ä¿¡æ¯ï¼šæ˜¾ç¤ºä»APIè¿”å›çš„æ–‡ä»¶ä¿¡æ¯
                console.log('ä»APIè·å–çš„é¡¹ç›®æ–‡ä»¶ä¿¡æ¯:');
                files.forEach((file, index) => {
                    console.log(`æ–‡ä»¶ ${index + 1}:`, {
                        original_filename: file.original_filename,
                        filename: file.filename,
                        file_id: file.file_id,
                        size: file.size,
                        mimetype: file.mimetype
                    });
                });

                renderProjectFiles();

                logger.info(`æˆåŠŸåŠ è½½é¡¹ç›®æ–‡ä»¶: ${files.length} ä¸ª`);

            } catch (error) {
                console.error('åŠ è½½é¡¹ç›®æ–‡ä»¶å¤±è´¥:', error);
                showMessage('åŠ è½½é¡¹ç›®æ–‡ä»¶å¤±è´¥: ' + error.message, 'error');
                currentProjectFiles = [];
                renderProjectFiles();
            }
        }

        function renderProjectFiles() {
    const pageElement = document.getElementById('project-upload');
    if (!pageElement) return;

    let fileListContainer = pageElement.querySelector('.file-list-container');
    if (!fileListContainer) {
        fileListContainer = document.createElement('div');
        fileListContainer.className = 'file-list-container';
        pageElement.appendChild(fileListContainer);
    }

    const files = currentProjectFiles || [];
    const project = allProjects.find(p => p._id === currentProject);
    const projectName = project ? project.name : 'å½“å‰é¡¹ç›®';

    if (files.length === 0) {
        fileListContainer.innerHTML = `
            <h3 style="margin-bottom: 10px;">${projectName}çš„æ–‡ä»¶</h3>
            <p style="color: #666;">æš‚æ— æ–‡ä»¶</p>
        `;
        return;
    }

    fileListContainer.innerHTML = `
        <h3 style="margin-bottom: 10px;">${projectName}çš„æ–‡ä»¶ (${files.length}ä¸ª)</h3>
        <div class="file-list">
            ${files.map((file, index) => {
                let displayName = 'æœªçŸ¥æ–‡ä»¶';
                if (file.original_filename && file.original_filename.trim() !== '') {
                    displayName = file.original_filename;
                } else if (file.filename && file.filename.trim() !== '') {
                    displayName = file.filename;
                }

                // è§£æçŠ¶æ€æ˜¾ç¤º
                const parseStatus = file.parse_status || 'pending';
                const parseEnabled = file.parse_enabled !== false;

                let statusBadge = '';
                let statusColor = '';

                switch(parseStatus) {
                    case 'pending':
                        statusBadge = 'æœªè§£æ';
                        statusColor = '#666';
                        break;
                    case 'processing':
                        statusBadge = 'è§£æä¸­';
                        statusColor = '#1a73e8';
                        break;
                    case 'completed':
                        statusBadge = 'å·²è§£æ';
                        statusColor = '#34a853';
                        break;
                    case 'failed':
                        statusBadge = 'è§£æå¤±è´¥';
                        statusColor = '#ea4335';
                        break;
                }

                return `
                <div class="file-card">
                    <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 12px;">
                        <div style="font-size: 24px;">${getFileIcon(file.mimetype)}</div>
                        <div style="flex: 1;">
                            <div style="font-weight: 500; margin-bottom: 4px; word-break: break-all;" title="${displayName}">
                                ${displayName}
                            </div>
                            <div style="font-size: 12px; color: #5f6368;">
                                ${formatFileSize(file.size)} â€¢ ${formatDate(file.upload_date)}
                            </div>
                            <div style="display: flex; align-items: center; gap: 12px; margin-top: 8px;">
                                <div style="display: flex; align-items: center; gap: 8px;">
                                    <span style="font-size: 12px; color: #5f6368;">å¯ç”¨è§£æ:</span>
                                    <label class="switch" style="position: relative; display: inline-block; width: 34px; height: 20px;border-radius: 20px;background: grey;">
                                        <input type="checkbox" ${parseEnabled ? 'checked' : ''} onchange="toggleParseEnabled('${file.file_id}', this.checked)">
                                        <span class="slider" style="position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; transition: .4s; border-radius: 20px;"></span>
                                    </label>
                                </div>
                                <div style="display: flex; align-items: center; gap: 4px;">
                                    <span style="font-size: 12px; color: #5f6368;">è§£æçŠ¶æ€:</span>
                                    <span style="font-size: 12px; color: ${statusColor}; font-weight: 500;">${statusBadge}</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div style="display: flex; gap: 8px;">
                        <button class="btn-small primary" onclick="parseFile('${file.file_id}', '${displayName.replace(/'/g, "\\'")}')">
                            ${parseStatus === 'processing' ? 'è§£æä¸­...' : 'è§£æ'}
                        </button>
                        <button class="btn-small primary" onclick="downloadFile('${file.file_id}', '${displayName.replace(/'/g, "\\'")}')">
                            ä¸‹è½½
                        </button>
                        <button class="btn-small danger" onclick="deleteProjectFile('${file.file_id}', '${displayName.replace(/'/g, "\\'")}')">
                            åˆ é™¤
                        </button>
                    </div>
                </div>
            `}).join('')}
        </div>
    `;
}

// æ·»åŠ åˆ‡æ¢è§£æçŠ¶æ€çš„å‡½æ•°
async function toggleParseEnabled(fileId, enabled) {
    try {
        const response = await fetch(`${API_BASE_URL}/files/${fileId}/parse-status`, {
            method: 'PUT',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                parse_enabled: enabled
            })
        });

        const result = await response.json();

        if (response.ok) {
            showMessage(`è§£æçŠ¶æ€å·²${enabled ? 'å¯ç”¨' : 'ç¦ç”¨'}`, 'success');
            await loadProjectFiles(); // åˆ·æ–°æ–‡ä»¶åˆ—è¡¨
        } else {
            showMessage(result.error || 'æ›´æ–°å¤±è´¥', 'error');
        }
    } catch (error) {
        console.error('æ›´æ–°è§£æçŠ¶æ€å¤±è´¥:', error);
        showMessage('æ›´æ–°è§£æçŠ¶æ€å¤±è´¥: ' + error.message, 'error');
    }
}

// æ·»åŠ è§£ææ–‡ä»¶çš„å‡½æ•°
async function parseFile(fileId, filename) {
    try {
        showMessage(`å¼€å§‹è§£ææ–‡ä»¶: ${filename}`, 'info');
        // è°ƒç”¨åç«¯è§£æAPI
        const response = await fetch(`${API_BASE_URL}/files/${fileId}/parse`, {
            method: 'POST',
        });
        const result = await response.json();
        if (response.ok) {
                showMessage(`æ–‡ä»¶è§£æå®Œæˆ: ${filename}`, 'success');
        } else {
            showMessage(result.error || 'è§£æå¤±è´¥', 'error');
        }
                await loadProjectFiles(); // åˆ·æ–°æ˜¾ç¤º
    } catch (error) {
        console.error('è§£ææ–‡ä»¶å¤±è´¥:', error);
        showMessage('è§£ææ–‡ä»¶å¤±è´¥: ' + error.message, 'error');
    }
}

        async function uploadProjectFiles(files) {
            if (!currentProject) {
                showMessage('è¯·å…ˆé€‰æ‹©ä¸€ä¸ªé¡¹ç›®', 'error');
                return false;
            }

            try {
                const formData = new FormData();

                // æ·»åŠ è°ƒè¯•ä¿¡æ¯ï¼šæ˜¾ç¤ºè¦ä¸Šä¼ çš„æ–‡ä»¶
                console.log('=== å‡†å¤‡ä¸Šä¼ é¡¹ç›®æ–‡ä»¶ ===');
                for (let i = 0; i < files.length; i++) {
                    formData.append('files', files[i]);
                    console.log(`ä¸Šä¼ æ–‡ä»¶ ${i + 1}: "${files[i].name}" (${formatFileSize(files[i].size)})`);
                }

                showUploadProgress('project', true);

                const response = await fetch(`${API_BASE_URL}/projects/${currentProject}/files`, {
                    method: 'POST',
                    body: formData
                });

                const result = await response.json();

                // æ·»åŠ è°ƒè¯•ä¿¡æ¯ï¼šæ˜¾ç¤ºæœåŠ¡å™¨è¿”å›ç»“æœ
                console.log('=== æœåŠ¡å™¨ä¸Šä¼ å“åº” ===');
                console.log('å“åº”çŠ¶æ€:', response.status);
                console.log('å“åº”æ•°æ®:', result);

                showUploadProgress('project', false);

                if (response.ok) {
                    const successCount = result.uploaded_files ? result.uploaded_files.length : 0;
                    let message = `æˆåŠŸä¸Šä¼  ${successCount} ä¸ªæ–‡ä»¶åˆ°é¡¹ç›®`;

                    if (result.project_name) {
                        message += `: ${result.project_name}`;
                    }

                    // æ˜¾ç¤ºæ¯ä¸ªä¸Šä¼ æ–‡ä»¶çš„è¯¦ç»†ä¿¡æ¯
                    if (result.uploaded_files) {
                        console.log('=== ä¸Šä¼ æˆåŠŸçš„æ–‡ä»¶è¯¦æƒ… ===');
                        result.uploaded_files.forEach((file, index) => {
                            console.log(`æ–‡ä»¶ ${index + 1}:`, {
                                original_filename: file.original_filename,
                                filename: file.filename,
                                file_id: file.file_id,
                                size: file.size
                            });
                        });
                    }

                    if (result.errors && result.errors.length > 0) {
                        message += `ï¼Œ${result.errors.length} ä¸ªæ–‡ä»¶å¤±è´¥`;
                        console.warn('ä¸Šä¼ é”™è¯¯:', result.errors);
                    }

                    showMessage(message, 'success');

                    // é‡æ–°åŠ è½½é¡¹ç›®æ–‡ä»¶åˆ—è¡¨
                    await loadProjectFiles();

                    return true;
                } else {
                    console.error('ä¸Šä¼ å¤±è´¥:', result);
                    showMessage(result.error || 'æ–‡ä»¶ä¸Šä¼ å¤±è´¥', 'error');
                    return false;
                }

            } catch (error) {
                showUploadProgress('project', false);
                console.error('æ–‡ä»¶ä¸Šä¼ å¤±è´¥:', error);
                showMessage('æ–‡ä»¶ä¸Šä¼ å¤±è´¥: ' + error.message, 'error');
                return false;
            }
        }

        async function deleteProjectFile(fileId, filename) {
            try {
                if (!confirm(`ç¡®å®šè¦åˆ é™¤æ–‡ä»¶ "${filename}" å—ï¼Ÿ`)) {
                    return;
                }

                const response = await fetch(`${API_BASE_URL}/files/${fileId}`, {
                    method: 'DELETE'
                });

                const result = await response.json();

                if (response.ok) {
                    showMessage(`æ–‡ä»¶ "${filename}" åˆ é™¤æˆåŠŸ`, 'success');

                    // é‡æ–°åŠ è½½é¡¹ç›®æ–‡ä»¶åˆ—è¡¨
                    await loadProjectFiles();
                } else {
                    showMessage(result.error || 'åˆ é™¤æ–‡ä»¶å¤±è´¥', 'error');
                }

            } catch (error) {
                console.error('åˆ é™¤æ–‡ä»¶å¤±è´¥:', error);
                showMessage('åˆ é™¤æ–‡ä»¶å¤±è´¥: ' + error.message, 'error');
            }
        }

        // ============ åˆ†ç±»æ–‡ä»¶ç®¡ç† ============
        async function loadCategoryFiles(category) {
            try {
                const response = await fetch(`${API_BASE_URL}/files/category/${category}`);

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }

                const files = await response.json();
                currentCategoryFiles[category] = files;

                // è°ƒè¯•ä¿¡æ¯ï¼šæ˜¾ç¤ºä»APIè¿”å›çš„æ–‡ä»¶ä¿¡æ¯
                console.log(`ä»APIè·å–çš„${FILE_CATEGORIES[category]}æ–‡ä»¶ä¿¡æ¯:`);
                files.forEach((file, index) => {
                    console.log(`æ–‡ä»¶ ${index + 1}:`, {
                        original_filename: file.original_filename,
                        filename: file.filename,
                        file_id: file.file_id,
                        size: file.size,
                        mimetype: file.mimetype
                    });
                });

                renderCategoryFiles(category);

                logger.info(`æˆåŠŸåŠ è½½ ${category} ç±»åˆ«æ–‡ä»¶: ${files.length} ä¸ª`);

            } catch (error) {
                console.error(`åŠ è½½ ${category} æ–‡ä»¶å¤±è´¥:`, error);
                showMessage(`åŠ è½½${FILE_CATEGORIES[category]}æ–‡ä»¶å¤±è´¥: ` + error.message, 'error');
                currentCategoryFiles[category] = [];
            }
        }

        function renderCategoryFiles(category) {
            const pageElement = document.getElementById(`upload-${category}`);
            if (!pageElement) return;

            let fileListContainer = pageElement.querySelector('.file-list-container');
            if (!fileListContainer) {
                fileListContainer = document.createElement('div');
                fileListContainer.className = 'file-list-container';
                pageElement.appendChild(fileListContainer);
            }

            const files = currentCategoryFiles[category] || [];
            const categoryName = FILE_CATEGORIES[category];

            if (files.length === 0) {
                fileListContainer.innerHTML = `
                    <h3 style="margin-bottom: 10px;">å·²ä¸Šä¼ çš„${categoryName}æ–‡ä»¶</h3>
                    <p style="color: #666;">æš‚æ— ${categoryName}æ–‡ä»¶</p>
                `;
                return;
            }

            console.log(`=== æ¸²æŸ“${categoryName}æ–‡ä»¶åˆ—è¡¨ ===`);
            fileListContainer.innerHTML = `
                <h3 style="margin-bottom: 10px;">å·²ä¸Šä¼ çš„${categoryName}æ–‡ä»¶ (${files.length}ä¸ª)</h3>
                <div class="file-list">
                    ${files.map((file, index) => {
                        // æ›´è¯¦ç»†çš„æ–‡ä»¶åå¤„ç†é€»è¾‘
                        let displayName = 'æœªçŸ¥æ–‡ä»¶';

                        if (file.original_filename && file.original_filename.trim() !== '') {
                            displayName = file.original_filename;
                        } else if (file.filename && file.filename.trim() !== '') {
                            displayName = file.filename;
                        }

                        // è°ƒè¯•ä¿¡æ¯
                        console.log(`æ¸²æŸ“${categoryName}æ–‡ä»¶ ${index + 1}:`, {
                            original_filename: file.original_filename,
                            filename: file.filename,
                            displayName: displayName,
                            file_id: file.file_id
                        });

                        return `
                        <div class="file-card">
                            <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 12px;">
                                <div style="font-size: 24px;">${getFileIcon(file.mimetype)}</div>
                                <div style="flex: 1;">
                                    <div style="font-weight: 500; margin-bottom: 4px; word-break: break-all;" title="${displayName}">
                                        ${displayName}
                                    </div>
                                    <div style="font-size: 12px; color: #5f6368;">
                                        ${formatFileSize(file.size)} â€¢ ${formatDate(file.upload_date)}
                                    </div>
                                    ${file.original_filename && file.filename && file.original_filename !== file.filename ? `
                                        <div style="font-size: 10px; color: #888; margin-top: 2px;">
                                            å­˜å‚¨ä¸º: ${file.filename}
                                        </div>
                                    ` : ''}
                                    <!-- è°ƒè¯•ä¿¡æ¯æ˜¾ç¤º -->
                                    <div style="font-size: 9px; color: #ccc; margin-top: 1px;">
                                        ID: ${file.file_id} | Original: ${file.original_filename || 'null'} | Storage: ${file.filename || 'null'}
                                    </div>
                                </div>
                            </div>
                            <div style="display: flex; gap: 8px;">
                                <button class="btn-small primary" onclick="downloadFile('${file.file_id}', '${displayName.replace(/'/g, "\\'")}')">
                                    ä¸‹è½½
                                </button>
                                <button class="btn-small danger" onclick="deleteFile('${file.file_id}', '${displayName.replace(/'/g, "\\'")}', '${category}')">
                                    åˆ é™¤
                                </button>
                            </div>
                        </div>
                    `}).join('')}
                </div>
            `;
        }

        async function uploadCategoryFiles(files, category) {
            try {
                const formData = new FormData();

                // æ·»åŠ è°ƒè¯•ä¿¡æ¯ï¼šæ˜¾ç¤ºè¦ä¸Šä¼ çš„æ–‡ä»¶
                console.log(`=== å‡†å¤‡ä¸Šä¼ ${FILE_CATEGORIES[category]}æ–‡ä»¶ ===`);
                for (let i = 0; i < files.length; i++) {
                    formData.append('files', files[i]);
                    console.log(`ä¸Šä¼ æ–‡ä»¶ ${i + 1}: "${files[i].name}" (${formatFileSize(files[i].size)})`);
                }

                showUploadProgress(category, true);

                const response = await fetch(`${API_BASE_URL}/files/category/${category}`, {
                    method: 'POST',
                    body: formData
                });

                const result = await response.json();

                // æ·»åŠ è°ƒè¯•ä¿¡æ¯ï¼šæ˜¾ç¤ºæœåŠ¡å™¨è¿”å›ç»“æœ
                console.log(`=== ${FILE_CATEGORIES[category]}ä¸Šä¼ å“åº” ===`);
                console.log('å“åº”çŠ¶æ€:', response.status);
                console.log('å“åº”æ•°æ®:', result);

                showUploadProgress(category, false);

                if (response.ok) {
                    const successCount = result.uploaded_files ? result.uploaded_files.length : 0;
                    let message = `æˆåŠŸä¸Šä¼  ${successCount} ä¸ªæ–‡ä»¶åˆ°${FILE_CATEGORIES[category]}`;

                    // æ˜¾ç¤ºæ¯ä¸ªä¸Šä¼ æ–‡ä»¶çš„è¯¦ç»†ä¿¡æ¯
                    if (result.uploaded_files) {
                        console.log(`=== ${FILE_CATEGORIES[category]}ä¸Šä¼ æˆåŠŸçš„æ–‡ä»¶è¯¦æƒ… ===`);
                        result.uploaded_files.forEach((file, index) => {
                            console.log(`æ–‡ä»¶ ${index + 1}:`, {
                                original_filename: file.original_filename,
                                filename: file.filename,
                                file_id: file.file_id,
                                size: file.size
                            });
                        });
                    }

                    if (result.errors && result.errors.length > 0) {
                        message += `ï¼Œ${result.errors.length} ä¸ªæ–‡ä»¶å¤±è´¥`;
                        console.warn('ä¸Šä¼ é”™è¯¯:', result.errors);
                    }

                    showMessage(message, 'success');

                    // é‡æ–°åŠ è½½æ–‡ä»¶åˆ—è¡¨
                    await loadCategoryFiles(category);

                    return true;
                } else {
                    console.error('ä¸Šä¼ å¤±è´¥:', result);
                    showMessage(result.error || 'æ–‡ä»¶ä¸Šä¼ å¤±è´¥', 'error');
                    return false;
                }

            } catch (error) {
                showUploadProgress(category, false);
                console.error('æ–‡ä»¶ä¸Šä¼ å¤±è´¥:', error);
                showMessage('æ–‡ä»¶ä¸Šä¼ å¤±è´¥: ' + error.message, 'error');
                return false;
            }
        }

        function showUploadProgress(category, show) {
            const progressElement = document.getElementById(`uploadProgress-${category}`);
            if (progressElement) {
                progressElement.style.display = show ? 'block' : 'none';
            }
        }

        function getFileIcon(mimetype) {
            if (!mimetype) return 'ğŸ“„';

            if (mimetype.startsWith('image/')) return 'ğŸ–¼ï¸';
            if (mimetype.startsWith('video/')) return 'ğŸ¥';
            if (mimetype.startsWith('audio/')) return 'ğŸµ';
            if (mimetype.includes('pdf')) return 'ğŸ“‘';
            if (mimetype.includes('word') || mimetype.includes('document')) return 'ğŸ“';
            if (mimetype.includes('excel') || mimetype.includes('spreadsheet')) return 'ğŸ“Š';
            if (mimetype.includes('powerpoint') || mimetype.includes('presentation')) return 'ğŸ“ˆ';
            if (mimetype.includes('zip') || mimetype.includes('rar') || mimetype.includes('7z')) return 'ğŸ—œï¸';
            if (mimetype.includes('text')) return 'ğŸ“„';

            return 'ğŸ“„';
        }

        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';

            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));

            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        function formatDate(dateString) {
            try {
                const date = new Date(dateString);
                return date.toLocaleDateString('zh-CN', {
                    year: 'numeric',
                    month: '2-digit',
                    day: '2-digit',
                    hour: '2-digit',
                    minute: '2-digit'
                });
            } catch (error) {
                return dateString;
            }
        }

        async function downloadFile(fileId, filename) {
            try {
                const response = await fetch(`${API_BASE_URL}/files/${fileId}/download`);

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.error || 'ä¸‹è½½å¤±è´¥');
                }

                const blob = await response.blob();
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = filename;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                window.URL.revokeObjectURL(url);

                showMessage(`æ–‡ä»¶ "${filename}" ä¸‹è½½å®Œæˆ`, 'success');

            } catch (error) {
                console.error('æ–‡ä»¶ä¸‹è½½å¤±è´¥:', error);
                showMessage('æ–‡ä»¶ä¸‹è½½å¤±è´¥: ' + error.message, 'error');
            }
        }

        async function deleteFile(fileId, filename, category) {
            try {
                if (!confirm(`ç¡®å®šè¦åˆ é™¤æ–‡ä»¶ "${filename}" å—ï¼Ÿ`)) {
                    return;
                }

                const response = await fetch(`${API_BASE_URL}/files/${fileId}`, {
                    method: 'DELETE'
                });

                const result = await response.json();

                if (response.ok) {
                    showMessage(`æ–‡ä»¶ "${filename}" åˆ é™¤æˆåŠŸ`, 'success');

                    // é‡æ–°åŠ è½½æ–‡ä»¶åˆ—è¡¨
                    if (category) {
                        await loadCategoryFiles(category);
                    }
                } else {
                    showMessage(result.error || 'åˆ é™¤æ–‡ä»¶å¤±è´¥', 'error');
                }

            } catch (error) {
                console.error('åˆ é™¤æ–‡ä»¶å¤±è´¥:', error);
                showMessage('åˆ é™¤æ–‡ä»¶å¤±è´¥: ' + error.message, 'error');
            }
        }

        // ============ æ–‡ä»¶ä¸Šä¼ å¤„ç† ============
        function handleDragOver(e) {
            e.preventDefault();
            e.currentTarget.classList.add('dragover');
        }

        function handleDragLeave(e) {
            e.preventDefault();
            e.currentTarget.classList.remove('dragover');
        }

        function handleDrop(e, category) {
            e.preventDefault();
            e.currentTarget.classList.remove('dragover');
            const files = e.dataTransfer.files;
            handleFiles(files, category);
        }

        function handleFileSelect(e, category) {
            const files = e.target.files;
            handleFiles(files, category);
        }

        function handleFiles(files, category) {
            if (files.length === 0) return;

            // æ£€æŸ¥æ–‡ä»¶æ•°é‡
            if (files.length > 50) {
                showMessage('ä¸€æ¬¡æœ€å¤šä¸Šä¼ 50ä¸ªæ–‡ä»¶', 'error');
                return;
            }

            // æ£€æŸ¥æ–‡ä»¶å¤§å°
            const maxSize = 100 * 1024 * 1024; // 100MB
            const oversizedFiles = [];

            for (let i = 0; i < files.length; i++) {
                if (files[i].size > maxSize) {
                    oversizedFiles.push(files[i].name);
                }
            }

            if (oversizedFiles.length > 0) {
                showMessage(`ä»¥ä¸‹æ–‡ä»¶è¿‡å¤§ï¼ˆè¶…è¿‡100MBï¼‰ï¼š${oversizedFiles.join(', ')}`, 'error');
                return;
            }

            // è°ƒè¯•ä¿¡æ¯ï¼šæ˜¾ç¤ºæ–‡ä»¶åŸå§‹åç§°
            console.log('å‡†å¤‡ä¸Šä¼ çš„æ–‡ä»¶:');
            for (let i = 0; i < files.length; i++) {
                console.log(`æ–‡ä»¶ ${i + 1}: ${files[i].name} (${formatFileSize(files[i].size)})`);
            }

            // æ ¹æ®ç±»åˆ«ä¸Šä¼ æ–‡ä»¶
            if (category === 'project') {
                uploadProjectFiles(files);
            } else {
                uploadCategoryFiles(files, category);
            }
        }

        function viewDetails(id) {
            const resume = allResumes.find(r => r._id === id);
            if (!resume) return;

            // æ·»åŠ è°ƒè¯•ä¿¡æ¯
            console.log('=== æŸ¥çœ‹è¯¦æƒ…è°ƒè¯•ä¿¡æ¯ ===');
            console.log('ç®€å†ID:', id);
            console.log('ç®€å†æ•°æ®:', resume);
            console.log('å­—æ®µç»“æ„:', FIELD_STRUCTURE);
            console.log('å­—æ®µåˆ†ç»„:', FIELD_GROUPS);
            console.log('å­—æ®µåˆ†ç»„æ˜¾ç¤º:', FIELD_GROUPS_DISPLAY);
            console.log('ç®€å†å­—æ®µåˆ—è¡¨:', Object.keys(resume));

            // å·¦å³åˆ†æ å¸ƒå±€ï¼šå·¦ä¾§é¢„è§ˆï¼Œå³ä¾§æ“ä½œ
            const modalContent = `
                <div style="display: flex; gap: 20px; height: 80vh;">
                    <!-- å·¦ä¾§é¢„è§ˆåŒºåŸŸ -->
                    <div style="flex: 1; overflow-y: auto; padding: 20px; background: #f8f9fa; border-radius: 8px;">
                        <div style="background: white; padding: 30px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                            ${generateResumePreview(resume)}
                        </div>
                    </div>
                    <!-- å³ä¾§æ“ä½œåŒºåŸŸ -->
                    <div style="width: 300px; display: flex; flex-direction: column; gap: 15px;">
                        <div style="background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                            <h4 style="margin-bottom: 15px; color: #1a73e8;">å­—æ®µç»Ÿè®¡</h4>
                            <div style="font-size: 14px; color: #5f6368;">
                                <div>æ€»å­—æ®µæ•°: ${Object.keys(resume).length}</div>
                                <div>åŸºæœ¬ä¿¡æ¯: ${Object.keys(resume).filter(k => FIELD_GROUPS['basic_info'] && FIELD_GROUPS['basic_info'].includes(k)).length}</div>
                                <div>æ•™è‚²èƒŒæ™¯: ${Object.keys(resume).filter(k => FIELD_GROUPS['education'] && FIELD_GROUPS['education'].includes(k)).length}</div>
                                <div>å·¥ä½œç»å†: ${Object.keys(resume).filter(k => FIELD_GROUPS['work_experience'] && FIELD_GROUPS['work_experience'].includes(k)).length}</div>
                                <div>é¡¹ç›®ç»éªŒ: ${Object.keys(resume).filter(k => FIELD_GROUPS['project_experience'] && FIELD_GROUPS['project_experience'].includes(k)).length}</div>
                                <div>ä¸ªäººæŠ€èƒ½: ${Object.keys(resume).filter(k => FIELD_GROUPS['skills'] && FIELD_GROUPS['skills'].includes(k)).length}</div>
                                <div>è¯­è¨€æŠ€èƒ½: ${Object.keys(resume).filter(k => FIELD_GROUPS['language_skills'] && FIELD_GROUPS['language_skills'].includes(k)).length}</div>
                                <div>è¯ä¹¦å¥–é¡¹: ${Object.keys(resume).filter(k => FIELD_GROUPS['certificates'] && FIELD_GROUPS['certificates'].includes(k)).length}</div>
                                <div>åŸ¹è®­ç»å†: ${Object.keys(resume).filter(k => FIELD_GROUPS['training'] && FIELD_GROUPS['training'].includes(k)).length}</div>
                                <div>ç¤¾ä¼šå®è·µ: ${Object.keys(resume).filter(k => FIELD_GROUPS['social_practice'] && FIELD_GROUPS['social_practice'].includes(k)).length}</div>
                                <div>ä¸ªäººè¯„ä»·: ${Object.keys(resume).filter(k => FIELD_GROUPS['self_evaluation'] && FIELD_GROUPS['self_evaluation'].includes(k)).length}</div>
                                <div>è‡ªå®šä¹‰å­—æ®µ: ${Object.keys(resume).filter(k => !Object.values(FIELD_GROUPS).flat().includes(k)).length}</div>
                            </div>
                        </div>
                        <div style="background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                            <h4 style="margin-bottom: 15px; color: #1a73e8;">æ“ä½œ</h4>
                            <button class="action-btn" onclick="editResume('${id}')" style="width: 100%; margin-bottom: 10px;">âœï¸ ç¼–è¾‘ç®€å†</button>
                            <button class="action-btn secondary" onclick="exportResume('${id}')" style="width: 100%; margin-bottom: 10px;">ğŸ“„ å¯¼å‡ºæ•°æ®</button>
                            <button class="action-btn danger" onclick="deleteResume('${id}')" style="width: 100%;">ğŸ—‘ï¸ åˆ é™¤ç®€å†</button>
                        </div>
                    </div>
                </div>
            `;

            document.getElementById('modalTitle').textContent = `${resume.name || 'æœªçŸ¥å§“å'} - ç®€å†è¯¦æƒ…`;
            document.getElementById('modalBody').innerHTML = modalContent;
            document.getElementById('detailModal').style.display = 'flex';
        }

        // ç”Ÿæˆç®€å†é¢„è§ˆï¼ˆä½¿ç”¨è‡ªå®šä¹‰æ•°æ®ç»“æ„ï¼‰
        function generateResumePreview(resume) {
            return `
                <!-- ä¸ªäººä¿¡æ¯å¤´éƒ¨ -->
                <div style="text-align: center; margin-bottom: 30px; padding-bottom: 20px; border-bottom: 2px solid #e8eaed;">
                    <div style="width: 80px; height: 80px; border-radius: 50%; background: #1a73e8; display: flex; align-items: center; justify-content: center; margin: 0 auto 15px; color: white; font-size: 24px; font-weight: bold;">
                        ${resume.name ? resume.name.charAt(0) : 'U'}
                    </div>
                    <h2 style="margin-bottom: 10px; color: #202124;">${resume.name || 'å§“åæœªå¡«å†™'}</h2>
                    <div style="display: flex; justify-content: center; gap: 20px; color: #5f6368; font-size: 14px;">
                        ${resume.phone || resume.mobile ? `<span>ğŸ“ ${resume.phone || resume.mobile}</span>` : ''}
                        ${resume.email ? `<span>ğŸ“§ ${resume.email}</span>` : ''}
                        ${resume.living_address ? `<span>ğŸ“ ${resume.living_address}</span>` : ''}
                    </div>
                </div>

                ${generateAllSections(resume)}
            `;
        }

        // ç”Ÿæˆæ‰€æœ‰åˆ†ç»„å†…å®¹
        function generateAllSections(resume) {
            let html = '';
            
            console.log('=== generateAllSections è°ƒè¯•ä¿¡æ¯ ===');
            console.log('ç®€å†æ•°æ®:', resume);
            console.log('FIELD_GROUPS_DISPLAY:', FIELD_GROUPS_DISPLAY);
            
            // æŒ‰åˆ†ç»„é¡ºåºç”Ÿæˆå†…å®¹
            const sortedGroups = Object.entries(FIELD_GROUPS_DISPLAY)
                .sort((a, b) => a[1].order - b[1].order);
            
            console.log('æ’åºåçš„åˆ†ç»„:', sortedGroups);
            
            for (const [groupKey, groupConfig] of sortedGroups) {
                console.log(`å¤„ç†åˆ†ç»„: ${groupKey}`, groupConfig);
                const sectionHtml = generateSectionByGroup(groupKey, resume);
                console.log(`åˆ†ç»„ ${groupKey} ç”Ÿæˆçš„HTML:`, sectionHtml ? 'æœ‰å†…å®¹' : 'æ— å†…å®¹');
                if (sectionHtml) {
                    html += sectionHtml;
                }
            }
            
            // ç”Ÿæˆæœªåˆ†ç»„å­—æ®µ
            const otherFieldsHtml = generateOtherFieldsSection(resume);
            if (otherFieldsHtml) {
                html += otherFieldsHtml;
            }
            
            console.log('æœ€ç»ˆç”Ÿæˆçš„HTMLé•¿åº¦:', html.length);
            return html;
        }

        // æ ¹æ®åˆ†ç»„ç”Ÿæˆå†…å®¹
        function generateSectionByGroup(groupKey, resume) {
            const groupConfig = FIELD_GROUPS_DISPLAY[groupKey];
            const fields = FIELD_GROUPS[groupKey] || [];
            
            console.log(`=== generateSectionByGroup è°ƒè¯•ä¿¡æ¯ (${groupKey}) ===`);
            console.log('groupConfig:', groupConfig);
            console.log('fields:', fields);
            
            if (!groupConfig) {
                console.log(`åˆ†ç»„ ${groupKey} æ²¡æœ‰é…ç½®ï¼Œè·³è¿‡`);
                return '';
            }
            
            // æ£€æŸ¥æ˜¯å¦æœ‰æ•°æ®
            const hasData = fields.some(field => resume[field] !== undefined && resume[field] !== null && resume[field] !== '');
            console.log(`åˆ†ç»„ ${groupKey} æ™®é€šå­—æ®µæœ‰æ•°æ®:`, hasData);
            
            // å¯¹äºæ•°ç»„ç±»å‹çš„å­—æ®µï¼Œæ£€æŸ¥æ˜¯å¦æœ‰æ•°æ®
            const arrayFields = ['work_experience', 'project_experience', 'skills', 'language_skills', 'certificates', 'training', 'social_practice'];
            const hasArrayData = arrayFields.includes(groupKey) && Array.isArray(resume[groupKey]) && resume[groupKey].length > 0;
            console.log(`åˆ†ç»„ ${groupKey} æ•°ç»„å­—æ®µæœ‰æ•°æ®:`, hasArrayData, resume[groupKey]);
            
            if (!hasData && !hasArrayData) {
                console.log(`åˆ†ç»„ ${groupKey} æ²¡æœ‰æ•°æ®ï¼Œè·³è¿‡`);
                return '';
            }
            
            let html = `<div style="margin-bottom: 30px;"><h3 style="color: #1a73e8; margin-bottom: 15px;">${groupConfig.icon} ${groupConfig.name}</h3>`;
            
            // æ ¹æ®åˆ†ç»„ç±»å‹ç”Ÿæˆä¸åŒçš„å†…å®¹
            switch (groupKey) {
                case 'work_experience':
                    html += generateWorkExperienceSection(resume.work_experience);
                    break;
                case 'project_experience':
                    html += generateProjectExperienceSection(resume.project_experience);
                    break;
                case 'skills':
                    html += generateSkillsSection(resume.skills);
                    break;
                case 'language_skills':
                    html += generateLanguageSkillsSection(resume.language_skills);
                    break;
                case 'certificates':
                    html += generateCertificatesSection(resume.certificates);
                    break;
                case 'training':
                    html += generateTrainingSection(resume.training);
                    break;
                case 'social_practice':
                    html += generateSocialPracticeSection(resume.social_practice);
                    break;
                default:
                    // æ™®é€šå­—æ®µç»„
                    html += generateSimpleFieldsSection(fields, resume);
                    break;
            }
            
            html += '</div>';
            console.log(`åˆ†ç»„ ${groupKey} æœ€ç»ˆHTMLé•¿åº¦:`, html.length);
            return html;
        }

        // ç”Ÿæˆç®€å•å­—æ®µç»„
        function generateSimpleFieldsSection(fields, resume) {
            let html = '';
            fields.forEach(field => {
                if (resume[field] !== undefined && resume[field] !== null && resume[field] !== '') {
                    const fieldConfig = getFieldConfig(field);
                    const label = fieldConfig ? fieldConfig.label : field;
                    html += `<div style="margin-bottom: 8px;"><strong>${label}:</strong> ${resume[field]}</div>`;
                }
            });
            return html;
        }

        // è·å–å­—æ®µé…ç½®
        function getFieldConfig(fieldName) {
            for (const [groupKey, fields] of Object.entries(FIELD_STRUCTURE)) {
                if (fields[fieldName]) {
                    return fields[fieldName];
                }
            }
            return null;
        }

        // ç”Ÿæˆå·¥ä½œç»å†éƒ¨åˆ†
        function generateWorkExperienceSection(workExperience) {
            if (!Array.isArray(workExperience) || workExperience.length === 0) return '';
            
            return workExperience.map(work => `
                <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 15px; border-left: 4px solid #34a853;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                        <div style="font-weight: 600; color: #202124;">${work.job_position || 'èŒä½æœªå¡«å†™'}</div>
                        <span style="background: #34a853; color: white; padding: 2px 8px; border-radius: 12px; font-size: 11px;">å·¥ä½œ</span>
                    </div>
                    <div style="color: #5f6368; margin-bottom: 8px;">ğŸ¢ ${work.company_name || 'å…¬å¸æœªå¡«å†™'}</div>
                    ${work.department_name ? `<div style="color: #5f6368; margin-bottom: 8px;">ğŸ¢ ${work.department_name}</div>` : ''}
                    <div style="color: #5f6368; margin-bottom: 8px; font-size: 12px;">ğŸ“… ${work.work_start_time || ''} - ${work.work_end_time || ''}</div>
                    ${work.salary ? `<div style="color: #5f6368; margin-bottom: 8px;">ğŸ’° ${work.salary}</div>` : ''}
                    ${work.industry ? `<div style="color: #5f6368; margin-bottom: 8px;">ğŸ­ ${work.industry}</div>` : ''}
                    ${work.work_desc ? `<div style="line-height: 1.6; color: #202124;">${work.work_desc}</div>` : ''}
                    ${work.achievement ? `<div style="line-height: 1.6; color: #202124; margin-top: 8px;"><strong>å·¥ä½œæˆå°±:</strong> ${work.achievement}</div>` : ''}
                </div>
            `).join('');
        }

        // ç”Ÿæˆé¡¹ç›®ç»éªŒéƒ¨åˆ†
        function generateProjectExperienceSection(projectExperience) {
            if (!Array.isArray(projectExperience) || projectExperience.length === 0) return '';
            
            return projectExperience.map(project => `
                <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 15px; border-left: 4px solid #1a73e8;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                        <div style="font-weight: 600; color: #202124;">${project.project_name || 'é¡¹ç›®æœªå¡«å†™'}</div>
                        <span style="background: #1a73e8; color: white; padding: 2px 8px; border-radius: 12px; font-size: 11px;">é¡¹ç›®</span>
                    </div>
                    <div style="color: #5f6368; margin-bottom: 8px;">ğŸ‘¤ ${project.project_role || 'è§’è‰²æœªå¡«å†™'}</div>
                    <div style="color: #5f6368; margin-bottom: 8px; font-size: 12px;">ğŸ“… ${project.project_start_time || ''} - ${project.project_end_time || ''}</div>
                    ${project.project_technology ? `<div style="color: #5f6368; margin-bottom: 8px;">ğŸ’» ${project.project_technology}</div>` : ''}
                    ${project.project_scale ? `<div style="color: #5f6368; margin-bottom: 8px;">ğŸ“Š ${project.project_scale}</div>` : ''}
                    ${project.project_desc ? `<div style="line-height: 1.6; color: #202124; margin-bottom: 8px;">${project.project_desc}</div>` : ''}
                    ${project.project_content ? `<div style="line-height: 1.6; color: #5f6368; font-size: 14px; margin-bottom: 8px;">${project.project_content}</div>` : ''}
                    ${project.project_result ? `<div style="line-height: 1.6; color: #202124;"><strong>é¡¹ç›®æˆæœ:</strong> ${project.project_result}</div>` : ''}
                </div>
            `).join('');
        }

        // ç”ŸæˆæŠ€èƒ½éƒ¨åˆ†
        function generateSkillsSection(skills) {
            if (!Array.isArray(skills) || skills.length === 0) return '';
            
            return `<div style="display: flex; flex-wrap: wrap; gap: 8px;">
                ${skills.map(skill => 
                    `<span style="background: #e8f0fe; color: #1a73e8; padding: 6px 12px; border-radius: 16px; font-size: 12px; border: 1px solid #dadce0;">
                        ${skill.skill_name}${skill.skill_level ? ` - ${skill.skill_level}` : ''}${skill.skill_years ? ` (${skill.skill_years}å¹´)` : ''}
                    </span>`
                ).join('')}
            </div>`;
        }

        // ç”Ÿæˆè¯ä¹¦éƒ¨åˆ†
        function generateCertificatesSection(certificates) {
            if (!Array.isArray(certificates) || certificates.length === 0) return '';
            
            return certificates.map(cert => `
                <div style="background: #fff3e0; padding: 10px; border-radius: 6px; margin-bottom: 8px; border-left: 4px solid #ff9800;">
                    <div style="font-weight: 600; color: #202124;">${cert.award_info || 'è¯ä¹¦æœªå¡«å†™'}</div>
                    <div style="color: #5f6368; font-size: 12px;">ğŸ“… ${cert.award_time || ''}</div>
                    ${cert.award_level ? `<div style="color: #5f6368; font-size: 12px;">ğŸ† ${cert.award_level}</div>` : ''}
                    ${cert.award_issuer ? `<div style="color: #5f6368; font-size: 12px;">ğŸ›ï¸ ${cert.award_issuer}</div>` : ''}
                    ${cert.award_desc ? `<div style="color: #5f6368; margin-top: 4px;">${cert.award_desc}</div>` : ''}
                </div>
            `).join('');
        }

        // ç”ŸæˆåŸ¹è®­éƒ¨åˆ†
        function generateTrainingSection(training) {
            if (!Array.isArray(training) || training.length === 0) return '';
            
            return training.map(train => `
                <div style="background: #f3e5f5; padding: 10px; border-radius: 6px; margin-bottom: 8px; border-left: 4px solid #9c27b0;">
                    <div style="font-weight: 600; color: #202124;">${train.training_name || 'åŸ¹è®­æœªå¡«å†™'}</div>
                    <div style="color: #5f6368; font-size: 12px;">ğŸ“… ${train.training_time || ''}</div>
                    ${train.training_institution ? `<div style="color: #5f6368; font-size: 12px;">ğŸ« ${train.training_institution}</div>` : ''}
                    ${train.training_duration ? `<div style="color: #5f6368; font-size: 12px;">â±ï¸ ${train.training_duration}</div>` : ''}
                    ${train.training_desc ? `<div style="color: #5f6368; margin-top: 4px;">${train.training_desc}</div>` : ''}
                </div>
            `).join('');
        }

        // ç”Ÿæˆè¯­è¨€æŠ€èƒ½éƒ¨åˆ†
        function generateLanguageSkillsSection(languageSkills) {
            if (!Array.isArray(languageSkills) || languageSkills.length === 0) return '';
            
            return `<div style="display: flex; flex-wrap: wrap; gap: 8px;">
                ${languageSkills.map(lang => 
                    `<span style="background: #e8f5e8; color: #2e7d32; padding: 6px 12px; border-radius: 16px; font-size: 12px; border: 1px solid #c8e6c9;">
                        ${lang.language_name}${lang.language_level ? ` - ${lang.language_level}` : ''}${lang.language_score ? ` (${lang.language_score})` : ''}
                    </span>`
                ).join('')}
            </div>`;
        }

        // ç”Ÿæˆç¤¾ä¼šå®è·µéƒ¨åˆ†
        function generateSocialPracticeSection(socialPractice) {
            if (!Array.isArray(socialPractice) || socialPractice.length === 0) return '';
            
            return socialPractice.map(practice => `
                <div style="background: #f1f8e9; padding: 10px; border-radius: 6px; margin-bottom: 8px; border-left: 4px solid #8bc34a;">
                    <div style="font-weight: 600; color: #202124;">${practice.practice_name || 'å®è·µæœªå¡«å†™'}</div>
                    <div style="color: #5f6368; font-size: 12px;">ğŸ“… ${practice.practice_time || ''}</div>
                    ${practice.practice_role ? `<div style="color: #5f6368; font-size: 12px;">ğŸ‘¤ ${practice.practice_role}</div>` : ''}
                    ${practice.practice_organization ? `<div style="color: #5f6368; font-size: 12px;">ğŸ¢ ${practice.practice_organization}</div>` : ''}
                    ${practice.practice_desc ? `<div style="color: #5f6368; margin-top: 4px;">${practice.practice_desc}</div>` : ''}
                </div>
            `).join('');
        }

        // ç”Ÿæˆæœªåˆ†ç»„å­—æ®µéƒ¨åˆ†
        function generateOtherFieldsSection(resume) {
            const allGrouped = new Set(Object.values(FIELD_GROUPS).flat());
            const otherFields = Object.entries(resume)
                .filter(([key, value]) => !allGrouped.has(key) && value !== undefined && value !== null && value !== '')
                .map(([key, value]) => {
                    let display = value;
                    if (typeof value === 'object') {
                        display = `<pre style="white-space:pre-wrap; background: #f8f9fa; padding: 10px; border-radius: 4px; font-size: 12px;">${JSON.stringify(value, null, 2)}</pre>`;
                    }
                    return `<div style="margin-bottom: 8px;"><strong>${key}:</strong> ${display}</div>`;
                }).join('');
            
            if (!otherFields) return '';
            
            return `
                <div style="margin-bottom: 30px;">
                    <h3 style="color: #1a73e8; margin-bottom: 15px;">ğŸ“ å…¶ä»–ä¿¡æ¯</h3>
                    ${otherFields}
                </div>
            `;
        }

        // ç¼–è¾‘å¼¹çª—æ”¹ä¸ºåˆ†ç»„æŠ˜å å¼
        function editResume(id) {
            const resume = allResumes.find(r => r._id === id);
            if (!resume) return;

            // æ„å»ºåˆ†ç»„æŠ˜å å¼è¡¨å•
            let formHtml = '<form id="editResumeForm">';
            
            // æŒ‰åˆ†ç»„æ¸²æŸ“å­—æ®µ
            for (const [groupName, fields] of Object.entries(FIELD_GROUPS)) {
                let groupFields = '';
                fields.forEach(key => {
                    if (resume[key] !== undefined) {
                        groupFields += generateFieldInput(key, resume[key]);
                    }
                });
                
                if (groupFields) {
                    const displayName = GROUP_NAME_MAP[groupName] || groupName;
                    formHtml += `
                        <div class="field-group" style="margin-bottom: 20px; border: 1px solid #e8eaed; border-radius: 8px; overflow: hidden;">
                            <div class="group-header" style="background: #f8f9fa; padding: 12px 16px; cursor: pointer; font-weight: 600; color: #1a73e8;" onclick="toggleGroup(this)">
                                <span style="margin-right: 8px;">ğŸ“</span>${displayName}
                                <span class="toggle-icon" style="float: right;">â–¼</span>
                            </div>
                            <div class="group-content" style="padding: 16px;">
                                ${groupFields}
                            </div>
                        </div>
                    `;
                }
            }
            
            // æ·»åŠ å­—æ®µæŒ‰é’®
            formHtml += `
                <div style="margin-bottom: 20px; text-align: center;">
                    <button type="button" class="btn-small primary" onclick="addField()">+ æ·»åŠ è‡ªå®šä¹‰å­—æ®µ</button>
                </div>
                <div style="text-align: right;">
                    <button type="submit" class="action-btn">ğŸ’¾ ä¿å­˜</button>
                    <button type="button" class="action-btn secondary" style="margin-left: 10px;" onclick="closeModal()">âŒ å–æ¶ˆ</button>
                </div>
            </form>`;

            document.getElementById('modalTitle').textContent = 'âœï¸ ç¼–è¾‘ç®€å†';
            document.getElementById('modalBody').innerHTML = formHtml;
            document.getElementById('detailModal').style.display = 'flex';

            // è¡¨å•æäº¤äº‹ä»¶ï¼ˆä¿æŒåŸæœ‰é€»è¾‘ï¼‰
            document.getElementById('editResumeForm').onsubmit = async function(e) {
                e.preventDefault();
                const formData = new FormData(this);
                const data = {};
                
                // è°ƒè¯•ä¿¡æ¯
                console.log('è¡¨å•æäº¤ - åŸå§‹æ•°æ®:', resume);
                
                for (const [k, v] of formData.entries()) {
                    let value = v;
                    
                    // è°ƒè¯•ä¿¡æ¯
                    console.log(`å¤„ç†å­—æ®µ: ${k}`, {
                        originalValue: v,
                        originalType: typeof v,
                        resumeFieldType: typeof resume[k],
                        resumeFieldValue: resume[k]
                    });
                    
                    // å°è¯•è§£æJSON
                    if (v.trim() !== '') {
                        try {
                            value = JSON.parse(v);
                            console.log(`JSONè§£ææˆåŠŸ: ${k}`, value);
                        } catch (e) {
                            // JSONè§£æå¤±è´¥ï¼Œæ£€æŸ¥åŸå§‹å­—æ®µç±»å‹
                            if (Array.isArray(resume[k])) {
                                console.log(`å­—æ®µ ${k} åº”ä¸ºæ•°ç»„ï¼Œä½†è¾“å…¥ä¸æ˜¯æœ‰æ•ˆJSONï¼Œè®¾ä¸ºç©ºæ•°ç»„`);
                                value = [];
                            } else if (typeof resume[k] === 'object' && resume[k] !== null) {
                                console.log(`å­—æ®µ ${k} åº”ä¸ºå¯¹è±¡ï¼Œä½†è¾“å…¥ä¸æ˜¯æœ‰æ•ˆJSON`);
                                alert(`å­—æ®µ ${k} è¯·è¾“å…¥åˆæ³•çš„ JSON æ ¼å¼ï¼\n\nå½“å‰è¾“å…¥: ${v}\n\né”™è¯¯ä¿¡æ¯: ${e.message}`);
                                return;
                            } else {
                                // æ™®é€šå­—ç¬¦ä¸²å­—æ®µï¼Œä¿æŒåŸå€¼
                                value = v;
                                console.log(`å­—æ®µ ${k} ä¿æŒå­—ç¬¦ä¸²å€¼:`, value);
                            }
                        }
                    } else {
                        // ç©ºå€¼å¤„ç†
                        if (Array.isArray(resume[k])) {
                            value = [];
                        } else if (typeof resume[k] === 'object' && resume[k] !== null) {
                            value = {};
                        } else {
                            value = '';
                        }
                    }
                    
                    data[k] = value;
                }
                
                // å¤„ç†é‚®ç®±å­—æ®µåˆ«å
                if (data['é‚®ç®±'] && !data['email']) {
                    data['email'] = data['é‚®ç®±'];
                    delete data['é‚®ç®±'];
                }
                
                // åˆå¹¶æœªä¿®æ”¹çš„å­—æ®µ
                Object.entries(resume).forEach(([k, v]) => {
                    if (k === '_id') return;
                    if (!(k in data)) {
                        data[k] = v;
                    }
                });
                
                // è°ƒè¯•ä¿¡æ¯
                console.log('æäº¤çš„æ•°æ®:', data);
                
                try {
                    const response = await fetch(`${API_BASE_URL}/resume/${id}`, {
                        method: 'PUT',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(data)
                    });
                    const result = await response.json();
                    if (response.ok) {
                        showMessage('ç®€å†æ›´æ–°æˆåŠŸ', 'success');
                        closeModal();
                        await loadData();
                    } else {
                        showMessage(result.error || 'æ›´æ–°å¤±è´¥', 'error');
                    }
                } catch (error) {
                    showMessage('æ›´æ–°å¤±è´¥: ' + error.message, 'error');
                }
            };
        }

        // ç”Ÿæˆå­—æ®µè¾“å…¥æ§ä»¶
        function generateFieldInput(key, value) {
            let inputHtml = '';
            
            // è°ƒè¯•ä¿¡æ¯
            console.log(`ç”Ÿæˆå­—æ®µè¾“å…¥: ${key}`, {
                value: value,
                type: typeof value,
                isArray: Array.isArray(value),
                isObject: typeof value === 'object' && value !== null,
                constructor: value?.constructor?.name
            });
            
            // æ£€æŸ¥æ˜¯å¦ä¸ºå¤æ‚æ•°æ®ç±»å‹ï¼ˆå¯¹è±¡ã€æ•°ç»„ï¼‰
            if (typeof value === 'object' && value !== null) {
                // å¯¹è±¡æˆ–æ•°ç»„ç±»å‹ï¼Œä½¿ç”¨textareaæ˜¾ç¤ºJSON
                const jsonString = JSON.stringify(value, null, 2);
                inputHtml = `<textarea name="${key}" style="width:100%;padding:8px;border:1px solid #dadce0;border-radius:4px;min-height:80px;font-family:monospace;" placeholder="è¯·è¾“å…¥åˆæ³•JSONæ ¼å¼">${jsonString}</textarea>`;
            } else if (typeof value === 'string' && (value.startsWith('[') || value.startsWith('{'))) {
                // å¯èƒ½æ˜¯JSONå­—ç¬¦ä¸²ï¼Œå°è¯•è§£æ
                try {
                    const parsed = JSON.parse(value);
                    const jsonString = JSON.stringify(parsed, null, 2);
                    inputHtml = `<textarea name="${key}" style="width:100%;padding:8px;border:1px solid #dadce0;border-radius:4px;min-height:80px;font-family:monospace;" placeholder="è¯·è¾“å…¥åˆæ³•JSONæ ¼å¼">${jsonString}</textarea>`;
                } catch (e) {
                    // è§£æå¤±è´¥ï¼Œå½“ä½œæ™®é€šå­—ç¬¦ä¸²å¤„ç†
                    inputHtml = `<input type="text" name="${key}" value="${value !== undefined ? value : ''}" style="width:100%;padding:8px;border:1px solid #dadce0;border-radius:4px;" />`;
                }
            } else {
                // æ™®é€šç±»å‹ï¼Œä½¿ç”¨input
                inputHtml = `<input type="text" name="${key}" value="${value !== undefined ? value : ''}" style="width:100%;padding:8px;border:1px solid #dadce0;border-radius:4px;" />`;
            }
            
            return `
                <div style="margin-bottom: 12px;">
                    <label style="display: block; margin-bottom: 4px; font-weight: 500; color: #5f6368;">${key}:</label>
                    ${inputHtml}
                </div>
            `;
        }

        // åˆ†ç»„æŠ˜å /å±•å¼€
        function toggleGroup(header) {
            const content = header.nextElementSibling;
            const icon = header.querySelector('.toggle-icon');
            if (content.style.display === 'none') {
                content.style.display = 'block';
                icon.textContent = 'â–¼';
            } else {
                content.style.display = 'none';
                icon.textContent = 'â–¶';
            }
        }

        // å¯¼å‡ºç®€å†æ•°æ®
        function exportResume(id) {
            const resume = allResumes.find(r => r._id === id);
            if (!resume) return;
            
            const dataStr = JSON.stringify(resume, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `${resume.name || 'resume'}_${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            URL.revokeObjectURL(url);
            showMessage('ç®€å†æ•°æ®å¯¼å‡ºæˆåŠŸ', 'success');
        }

        // æ·»åŠ å­—æ®µæ—¶æ”¯æŒç±»å‹é€‰æ‹©å’Œåˆ†ç»„
        function addField() {
            const form = document.getElementById('editResumeForm');
            const div = document.createElement('div');
            div.style = 'display:flex;align-items:center;margin-bottom:10px;gap:8px;';
            div.innerHTML = `
                <input type="text" placeholder="å­—æ®µå(å»ºè®®è‹±æ–‡å°å†™)" style="min-width:90px;padding:6px 8px;border:1px solid #dadce0;border-radius:4px;" oninput="this.nextElementSibling.name=this.value" />
                <select style="padding:6px 8px;border:1px solid #dadce0;border-radius:4px;" onchange="updateFieldInputType(this)">
                    <option value="text">æ–‡æœ¬</option>
                    <option value="number">æ•°å­—</option>
                    <option value="date">æ—¥æœŸ</option>
                    <option value="json">JSON</option>
                </select>
                <input type="text" placeholder="å­—æ®µå€¼" style="flex:1;padding:6px 8px;border:1px solid #dadce0;border-radius:4px;" />
                <select style="padding:6px 8px;border:1px solid #dadce0;border-radius:4px;" name="group">
                    <option value="å…¶ä»–">å…¶ä»–</option>
                    <option value="åŸºæœ¬ä¿¡æ¯">åŸºæœ¬ä¿¡æ¯</option>
                    <option value="æ•™è‚²ç»å†">æ•™è‚²ç»å†</option>
                    <option value="å·¥ä½œç»å†">å·¥ä½œç»å†</option>
                    <option value="é¡¹ç›®ç»å†">é¡¹ç›®ç»å†</option>
                    <option value="æŠ€èƒ½åˆ—è¡¨">æŠ€èƒ½åˆ—è¡¨</option>
                    <option value="è¯­è¨€æŠ€èƒ½">è¯­è¨€æŠ€èƒ½</option>
                    <option value="è¯ä¹¦å¥–é¡¹">è¯ä¹¦å¥–é¡¹</option>
                    <option value="åŸ¹è®­ç»å†">åŸ¹è®­ç»å†</option>
                    <option value="ç¤¾ä¼šå®è·µ">ç¤¾ä¼šå®è·µ</option>
                    <option value="ä¸ªäººè¯„ä»·">ä¸ªäººè¯„ä»·</option>
                </select>
                <button type="button" class="btn-small danger" onclick="removeField(this)">åˆ é™¤</button>
            `;
            // å­—æ®µåå”¯ä¸€æ€§æ ¡éªŒ
            div.querySelector('input[placeholder^="å­—æ®µå"]').addEventListener('blur', function() {
                const fieldName = this.value.trim();
                if (fieldName && form.querySelector(`[name="${fieldName}"]`)) {
                    alert('è¯¥å­—æ®µå·²å­˜åœ¨ï¼Œè¯·å‹¿é‡å¤æ·»åŠ ï¼');
                    this.value = '';
                }
            });
            form.insertBefore(div, form.children[form.children.length-2]);
        }

        // å­—æ®µç±»å‹åˆ‡æ¢æ—¶æ¸²æŸ“ä¸åŒè¾“å…¥æ§ä»¶
        function updateFieldInputType(select) {
            const input = select.parentElement.querySelector('input[placeholder^="å­—æ®µå€¼"]');
            if (!input) return;
            const type = select.value;
            if (type === 'json') {
                const textarea = document.createElement('textarea');
                textarea.placeholder = 'è¯·è¾“å…¥åˆæ³•JSONï¼Œå¦‚ [ {...} ]';
                textarea.style = input.style.cssText + ';min-height:60px;';
                textarea.name = input.name;
                input.parentElement.replaceChild(textarea, input);
            } else {
                const newInput = document.createElement('input');
                newInput.type = type;
                newInput.placeholder = 'å­—æ®µå€¼';
                newInput.style = input.style.cssText;
                newInput.name = input.name;
                input.parentElement.replaceChild(newInput, input);
            }
        }

        // åˆ é™¤å­—æ®µ
        function removeField(btn, key) {
            const div = btn.parentElement;
            div.remove();
        }

        function deleteResume(id) {
            if (confirm('ç¡®å®šè¦åˆ é™¤è¿™ä»½ç®€å†å—ï¼Ÿ')) {
                showMessage('åˆ é™¤åŠŸèƒ½å¼€å‘ä¸­...', 'info');
            }
        }

        function closeModal() {
            document.getElementById('detailModal').style.display = 'none';
        }

        function showProjectManager() {
            renderProjectManagerList();
            document.getElementById('projectManagerModal').style.display = 'flex';
        }

        function closeProjectManager() {
            document.getElementById('projectManagerModal').style.display = 'none';
            document.getElementById('newProjectNameInput').value = '';
            document.getElementById('newProjectDescInput').value = '';
        }

        function renderProjectManagerList() {
            const listContainer = document.getElementById('projectManagerList');
            if (!listContainer) return;

            if (allProjects.length === 0) {
                listContainer.innerHTML = '<p style="color: #666; text-align: center; padding: 20px;">æš‚æ— é¡¹ç›®</p>';
                return;
            }

            listContainer.innerHTML = allProjects.map(project => `
                <div style="display: flex; align-items: center; justify-content: space-between; padding: 12px; border: 1px solid #e8eaed; border-radius: 6px; margin-bottom: 8px; ${project._id === currentProject ? 'background: #e8f0fe; border-color: #1a73e8;' : ''}">
                    <div style="flex: 1;">
                        <div style="font-weight: 500; margin-bottom: 2px; display: flex; align-items: center; gap: 8px;">
                            <span id="projectNameDisplay-${project._id}">${project.name}</span>
                            <input id="projectNameInput-${project._id}" type="text" value="${project.name}" style="display:none; padding:2px 6px; font-size:14px; border:1px solid #dadce0; border-radius:4px; min-width:80px;" onkeydown="handleProjectNameEdit(event, '${project._id}')" />
                            <button class="btn-small" onclick="showProjectNameEdit('${project._id}')">ç¼–è¾‘åç§°</button>
                        </div>
                        <div style="font-size: 12px; color: #5f6368;">${project.description || 'æš‚æ— æè¿°'}</div>
                        <div style="font-size: 11px; color: #5f6368; margin-top: 2px;">åˆ›å»ºæ—¶é—´: ${formatDate(project.created_at)}</div>
                    </div>
                    <div style="display: flex; gap: 8px;">
                        ${project._id === currentProject ? '<span style="color: #1a73e8; font-size: 12px; margin-right: 8px;">å½“å‰</span>' : ''}
                        <button class="btn-small" onclick="switchProject('${project._id}')" ${project._id === currentProject ? 'disabled' : ''}>
                            ${project._id === currentProject ? 'å·²é€‰æ‹©' : 'é€‰æ‹©'}
                        </button>
                        <button class="btn-small danger" onclick="deleteProject('${project._id}')">åˆ é™¤</button>
                    </div>
                </div>
            `).join('');
        }

        async function createProjectFromModal() {
            const nameInput = document.getElementById('newProjectNameInput');
            const descInput = document.getElementById('newProjectDescInput');

            const name = nameInput.value.trim();
            const description = descInput.value.trim();

            if (!name) {
                showMessage('è¯·è¾“å…¥é¡¹ç›®åç§°', 'error');
                nameInput.focus();
                return;
            }

            const success = await createProject(name, description);
            if (success) {
                nameInput.value = '';
                descInput.value = '';
                renderProjectManagerList();
            }
        }

        async function deleteProject(projectId) {
            try {
                const project = allProjects.find(p => p._id === projectId);
                const projectName = project ? project.name : 'é¡¹ç›®';

                if (!confirm(`ç¡®å®šè¦åˆ é™¤é¡¹ç›® "${projectName}" å—ï¼Ÿ\n\nåˆ é™¤åå°†åŒæ—¶åˆ é™¤é¡¹ç›®ä¸­çš„æ‰€æœ‰æ–‡ä»¶ï¼Œæ­¤æ“ä½œä¸å¯æ¢å¤ã€‚`)) {
                    return false;
                }

                const response = await fetch(`${API_BASE_URL}/projects/${projectId}`, {
                    method: 'DELETE'
                });

                const result = await response.json();

                if (response.ok) {
                    showMessage(`é¡¹ç›® "${projectName}" åˆ é™¤æˆåŠŸ`, 'success');

                    if (currentProject === projectId) {
                        currentProject = null;
                    }

                    await loadProjects();

                    if (allProjects.length > 0) {
                        switchProject(allProjects[0]._id);
                    } else {
                        currentProject = null;
                        switchPage('dashboard');
                    }

                    return true;
                } else {
                    showMessage(result.error || 'åˆ é™¤é¡¹ç›®å¤±è´¥', 'error');
                    return false;
                }

            } catch (error) {
                console.error('åˆ é™¤é¡¹ç›®å¤±è´¥:', error);
                showMessage('åˆ é™¤é¡¹ç›®å¤±è´¥: ' + error.message, 'error');
                return false;
            }
        }

        async function testConnection() {
            try {
                showMessage('æ­£åœ¨æµ‹è¯•è¿æ¥...', 'info');
                const response = await fetch(`${API_BASE_URL}/health`);

                if (response.ok) {
                    showMessage('APIè¿æ¥æ­£å¸¸', 'success');
                } else {
                    showMessage('APIè¿æ¥å¤±è´¥', 'error');
                }
            } catch (error) {
                showMessage('è¿æ¥æµ‹è¯•å¤±è´¥: ' + error.message, 'error');
            }
        }

        async function testAllEndpoints() {
            const endpoints = [
                { url: `${API_BASE_URL}/health`, name: 'å¥åº·æ£€æŸ¥' },
                { url: `${API_BASE_URL}/resume/all`, name: 'è·å–æ‰€æœ‰ç®€å†' },
                { url: `${API_BASE_URL}/resume/latest`, name: 'è·å–æœ€æ–°ç®€å†' },
                { url: `${API_BASE_URL}/projects`, name: 'è·å–é¡¹ç›®åˆ—è¡¨' },
                { url: `${API_BASE_URL}/system/info`, name: 'ç³»ç»Ÿä¿¡æ¯' }
            ];

            for (const endpoint of endpoints) {
                try {
                    const response = await fetch(endpoint.url);
                    const status = response.ok ? 'âœ…' : 'âŒ';
                    showMessage(`${status} ${endpoint.name}: ${response.status}`, response.ok ? 'success' : 'error');
                } catch (error) {
                    showMessage(`âŒ ${endpoint.name}: è¿æ¥å¤±è´¥`, 'error');
                }
                await new Promise(resolve => setTimeout(resolve, 1000));
            }
        }

        async function getSystemInfo() {
            try {
                const response = await fetch(`${API_BASE_URL}/system/info`);
                const data = await response.json();

                if (response.ok) {
                    let infoHtml = `
                        <h4>ç³»ç»Ÿä¿¡æ¯</h4>
                        <div class="info-row"><strong>æ•°æ®ç›®å½•:</strong> ${data.data_directory}</div>
                        <div class="info-row"><strong>é¡¹ç›®æ•°é‡:</strong> ${data.project_count}</div>
                        <div class="info-row"><strong>é¡¹ç›®æ–‡ä»¶æ•°:</strong> ${data.project_file_count}</div>
                        <div class="info-row"><strong>ç£ç›˜ä½¿ç”¨:</strong> ${data.total_disk_usage_mb} MB</div>
                        <br>
                        <h4>æ–‡ä»¶åˆ†ç±»ç»Ÿè®¡</h4>
                    `;

                    Object.entries(data.file_categories).forEach(([category, info]) => {
                        infoHtml += `<div class="info-row"><strong>${info.name}:</strong> ${info.count} ä¸ªæ–‡ä»¶</div>`;
                    });

                    document.getElementById('modalTitle').textContent = 'ç³»ç»Ÿä¿¡æ¯';
                    document.getElementById('modalBody').innerHTML = infoHtml;
                    document.getElementById('detailModal').style.display = 'flex';
                } else {
                    showMessage('è·å–ç³»ç»Ÿä¿¡æ¯å¤±è´¥', 'error');
                }
            } catch (error) {
                showMessage('è·å–ç³»ç»Ÿä¿¡æ¯å¤±è´¥: ' + error.message, 'error');
            }
        }

        async function refreshData() {
            await loadData();
            updateStats();

            // åˆ·æ–°å½“å‰é¡µé¢çš„æ–‡ä»¶åˆ—è¡¨
            if (currentPage.startsWith('upload-')) {
                const category = currentPage.replace('upload-', '');
                if (FILE_CATEGORIES[category]) {
                    loadCategoryFiles(category);
                }
            } else if (currentPage === 'project-upload') {
                loadProjectFiles();
            }
        }

        function exportData() {
            const dataStr = JSON.stringify(filteredResumes, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            const link = document.createElement('a');
            link.href = URL.createObjectURL(dataBlob);
            link.download = `ç®€å†æ•°æ®_${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            showMessage('æ•°æ®å¯¼å‡ºæˆåŠŸ', 'success');
        }

        function loadResumeManagement() {
            const managementGrid = document.getElementById('resumeManagementGrid');
            const originalGrid = document.getElementById('resumeGrid');
            if (managementGrid && originalGrid) {
                managementGrid.innerHTML = originalGrid.innerHTML;
            }
        }

        async function checkConnectionStatus() {
            try {
                const response = await fetch(`${API_BASE_URL}/health`);
                const statusElement = document.getElementById('connectionStatus');

                if (statusElement) {
                    if (response.ok) {
                        statusElement.textContent = 'âœ… è¿æ¥æ­£å¸¸';
                        statusElement.style.color = '#34a853';
                    } else {
                        statusElement.textContent = 'âŒ è¿æ¥å¼‚å¸¸';
                        statusElement.style.color = '#ea4335';
                    }
                }
            } catch (error) {
                const statusElement = document.getElementById('connectionStatus');
                if (statusElement) {
                    statusElement.textContent = 'âŒ è¿æ¥å¤±è´¥';
                    statusElement.style.color = '#ea4335';
                }
            }
        }

        function showMessage(message, type) {
            const messageElement = document.getElementById('statusMessage');
            messageElement.textContent = message;
            messageElement.className = `status-message ${type} show`;

            setTimeout(() => {
                messageElement.classList.remove('show');
            }, 3000);
        }

        // é”®ç›˜å¿«æ·é”®
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                closeModal();
            }
            if (e.ctrlKey && e.key === 'r') {
                e.preventDefault();
                refreshData();
            }
        });

        function showProjectNameEdit(projectId) {
            document.getElementById(`projectNameDisplay-${projectId}`).style.display = 'none';
            const input = document.getElementById(`projectNameInput-${projectId}`);
            input.style.display = 'inline-block';
            input.focus();
            input.select();
        }

        async function handleProjectNameEdit(event, projectId) {
            const input = document.getElementById(`projectNameInput-${projectId}`);
            if (event.key === 'Enter') {
                const newName = input.value.trim();
                if (!newName) {
                    showMessage('é¡¹ç›®åç§°ä¸èƒ½ä¸ºç©º', 'error');
                    return;
                }
                // è°ƒç”¨åç«¯API
                try {
                    const response = await fetch(`${API_BASE_URL}/projects/${projectId}/name`, {
                        method: 'PUT',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ name: newName })
                    });
                    const result = await response.json();
                    if (response.ok) {
                        showMessage('é¡¹ç›®åç§°ä¿®æ”¹æˆåŠŸ', 'success');
                        await loadProjects();
                    } else {
                        showMessage(result.error || 'ä¿®æ”¹å¤±è´¥', 'error');
                    }
                } catch (error) {
                    showMessage('ä¿®æ”¹å¤±è´¥: ' + error.message, 'error');
                }
                input.style.display = 'none';
                document.getElementById(`projectNameDisplay-${projectId}`).style.display = 'inline';
            } else if (event.key === 'Escape') {
                input.style.display = 'none';
                document.getElementById(`projectNameDisplay-${projectId}`).style.display = 'inline';
            }
        }

        function showSidebarProjectNameEdit(projectId) {
            document.getElementById(`sidebarProjectNameDisplay-${projectId}`).style.display = 'none';
            const input = document.getElementById(`sidebarProjectNameInput-${projectId}`);
            input.style.display = 'inline-block';
            input.focus();
            input.select();
        }

        async function handleSidebarProjectNameEdit(event, projectId) {
            const input = document.getElementById(`sidebarProjectNameInput-${projectId}`);
            if (event.key === 'Enter') {
                const newName = input.value.trim();
                if (!newName) {
                    showMessage('é¡¹ç›®åç§°ä¸èƒ½ä¸ºç©º', 'error');
                    return;
                }
                // è°ƒç”¨åç«¯API
                try {
                    const response = await fetch(`${API_BASE_URL}/projects/${projectId}/name`, {
                        method: 'PUT',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ name: newName })
                    });
                    const result = await response.json();
                    if (response.ok) {
                        showMessage('é¡¹ç›®åç§°ä¿®æ”¹æˆåŠŸ', 'success');
                        await loadProjects();
                    } else {
                        showMessage(result.error || 'ä¿®æ”¹å¤±è´¥', 'error');
                    }
                } catch (error) {
                    showMessage('ä¿®æ”¹å¤±è´¥: ' + error.message, 'error');
                }
                input.style.display = 'none';
                document.getElementById(`sidebarProjectNameDisplay-${projectId}`).style.display = 'inline';
            } else if (event.key === 'Escape') {
                input.style.display = 'none';
                document.getElementById(`sidebarProjectNameDisplay-${projectId}`).style.display = 'inline';
            }
        }
    </script>
</body>
</html>